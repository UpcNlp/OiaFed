# ====================================
# FedCL 客户端配置模板
# ====================================
# 客户端配置模板，支持多种learner和异构配置
# 复制此文件为 client_1_config.yaml, client_2_config.yaml 等

# 客户端基本信息
client:
  id: "fedcl_client_1"                     # 客户端唯一标识（请修改）
  name: "FedCL Client 1"                   # 客户端名称（请修改）
  type: "multi_learner"                    # 客户端类型: single_learner/multi_learner
  version: "1.0"                          # 配置版本

# 通信配置
communication:
  # 客户端自身配置（网络模式时监听地址）
  host: "localhost"                        # 客户端主机地址
  port: 8081                              # 客户端端口（请修改以区分不同客户端）
  max_workers: 3                          # 最大并发工作线程数
  timeout: 60.0                           # 通信超时时间（秒）
  retry_attempts: 3                       # 连接重试次数
  retry_delay: 5.0                        # 重试延迟（秒）
  heartbeat_interval: 30                  # 心跳间隔（秒）
  
  # 服务端配置（连接目标）
  server:
    host: "localhost"                      # 服务端主机地址
    port: 8080                            # 服务端端口
    
  # 通信模式说明：
  # - 如果客户端port与服务端port相同(8080)：启用本地模拟通信（伪联邦场景）
  # - 如果客户端port与服务端port不同：启用真实网络通信（真联邦场景）

# 学习器配置 - 支持多种learner
learners:
  # 选项1: 默认learner（基础持续学习）
  default_learner:
    class: "default"                       # 学习器类别
    enabled: true                          # 是否启用此learner
    
    # 模型配置
    model:
      type: "SimpleMLP"                    # 模型类型
      input_size: 784                      # 输入特征维度
      hidden_sizes: [256, 128]             # 隐藏层大小
      num_classes: 10                      # 输出类别数
      dropout_rate: 0.2                    # Dropout率
      activation: "relu"                   # 激活函数
      use_batch_norm: false                # 是否使用批归一化
    
    # 优化器配置
    optimizer:
      type: "SGD"                          # 优化器类型: SGD/Adam/AdamW
      lr: 0.01                            # 学习率
      momentum: 0.9                        # 动量（SGD专用）
      weight_decay: 1e-4                   # 权重衰减
      
    # 损失函数配置
    loss_function:
      type: "CrossEntropyLoss"             # 损失函数类型
      
    # 训练配置
    training:
      local_epochs: 5                      # 本地训练轮次
      batch_size: 32                       # 批大小
      
  # 选项2: EWC learner（弹性权重巩固）
  ewc_learner:
    class: "ewc"                           # EWC学习器
    enabled: false                         # 默认关闭，需要时启用
    
    model:
      type: "SimpleMLP"
      input_size: 784
      hidden_sizes: [256, 128]
      num_classes: 10
      dropout_rate: 0.2
    
    optimizer:
      type: "Adam"
      lr: 0.001
      weight_decay: 1e-4
      
    loss_function:
      type: "CrossEntropyLoss"
      
    training:
      local_epochs: 3
      batch_size: 32
      
    # EWC特定配置
    ewc_config:
      lambda_ewc: 0.4                      # EWC正则化系数
      sample_size: 200                     # Fisher信息矩阵采样大小

# 数据配置
training_data:
  client_train_data:
    type: "FederatedDataLoader"            # 联邦数据加载器
    dataset:
      name: "MNIST"                        # 数据集名称
      path: "data/MNIST"                   # 数据集路径
      split: "train"                       # 使用训练集
      download: true                       # 是否自动下载
      transform: "basic"                   # 数据变换: basic/augmented
      
    # 客户端数据分割配置
    federated_config:
      client_id: 1                         # 客户端ID（请修改为与上面client.id对应）
      num_clients: 3                       # 总客户端数
      distribution: "iid"                  # 数据分布: iid/non_iid
      samples_per_client: 1000             # 每个客户端样本数
    
    # 数据加载器参数
    loader_params:
      batch_size: 32                       # 批大小
      shuffle: true                        # 是否打乱数据
      num_workers: 0                       # 数据加载工作进程数

# Hook配置
hooks:
  enabled: true                            # 是否启用Hook系统
  
  # 基础Hook
  local_training_hook:
    enabled: true
    priority: 0
    config:
      log_training_progress: true
      
  evaluation_hook:
    enabled: true
    priority: 5

# 系统配置
system:
  device: "cpu"                            # 计算设备: cpu/cuda/auto
  random_seed: 42                          # 随机种子
  num_threads: 2                           # CPU线程数

# 日志配置
logging:
  level: "INFO"                            # 日志级别
  save_logs: true                          # 是否保存日志
  log_frequency: 10                        # 日志频率
  log_dir: "logs/client_1"                 # 日志目录（请修改为对应client.id）
  
  # 日志格式
  formatters:
    default: "[%(asctime)s][CLIENT-1][%(name)s][%(levelname)s] %(message)s"  # 请修改CLIENT-ID

# 实验配置
experiment:
  name: "client_template_experiment"       # 实验名称
  description: "FedCL客户端配置模板实验"    # 实验描述
  output_dir: "experiments/client_template" # 输出目录
