# ====================================
# FedCL 联邦学习框架配置模板
# ====================================
# 基于项目实际架构的完整配置示例
# 包含实验、数据、联邦学习、模型、训练、评估、检查点、Hook等所有配置项

# 实验配置
experiment:
  name: "fedcl_template_experiment"          # 实验名称（请修改为您的实验名）
  description: "FedCL联邦学习框架配置模板"     # 实验描述
  version: "1.0"                            # 配置版本
  created_date: "2025-08-05"                # 创建日期
  seed: 42                                  # 随机种子，确保结果可重现
  working_dir: "experiments/"               # 工作目录
  save_checkpoints: true                    # 启用检查点保存
  checkpoint_frequency: 1                   # 每轮保存一次检查点
  logging:
    level: "INFO"                           # 日志级别: DEBUG/INFO/WARNING/ERROR

# 数据配置
dataset:
  name: "MNIST"                             # 数据集名称: MNIST/CIFAR10/自定义
  path: "data/MNIST"                        # 数据集路径
  type: "classification"                    # 任务类型: classification/regression
  num_classes: 10                           # 分类类别数（分类任务）
  split_strategy: "federated"               # 数据分割策略
  split_config:
    num_clients: 3                          # 客户端数量
    distribution: "iid"                     # 数据分布: iid/non_iid
    min_samples_per_client: 1000            # 每个客户端最少样本数
    test_split: 0.2                         # 测试集比例
    random_seed: 42                         # 数据分割随机种子
    # 非IID分布配置（当distribution="non_iid"时启用）
    # alpha: 0.5                            # Dirichlet分布参数，越小越不均衡

# 联邦学习配置
federation:
  num_rounds: 5                             # 联邦学习总轮次
  min_clients: 2                            # 每轮最少参与客户端数
  max_clients: 3                            # 每轮最多参与客户端数
  client_fraction: 1.0                      # 客户端参与比例 (0.0-1.0)
  aggregation_strategy: "fedavg"            # 聚合策略: fedavg/fedprox/custom

# 模型配置
model:
  type: "SimpleMLP"                         # 模型类型: SimpleMLP/ResNet18/CNN/自定义
  input_size: 784                           # 输入特征维度 (MNIST: 784, CIFAR10: 3072)
  hidden_sizes: [256, 128]                  # 隐藏层大小列表
  num_classes: 10                           # 输出类别数
  dropout_rate: 0.2                         # Dropout比率
  activation: "relu"                        # 激活函数: relu/tanh/sigmoid
  use_batch_norm: false                     # 是否使用批标准化

# 训练配置
training:
  local_epochs: 3                           # 本地训练轮次
  batch_size: 32                            # 批次大小
  optimizer:
    type: "SGD"                             # 优化器类型: SGD/Adam/AdamW
    lr: 0.01                                # 学习率
    momentum: 0.9                           # 动量 (SGD专用)
    weight_decay: 1e-4                      # 权重衰减（L2正则化）
    # Adam/AdamW 参数 (当type="Adam"或"AdamW"时)
    # beta1: 0.9                            # Adam beta1 参数
    # beta2: 0.999                          # Adam beta2 参数
  loss_function: "CrossEntropyLoss"         # 损失函数
  device: "cpu"                             # 设备: cpu/cuda/auto

# 评估配置
evaluation:
  metrics: ["accuracy", "loss"]             # 评估指标列表
  test_frequency: 1                         # 测试频率（每N轮测试一次）
  convergence_threshold: 0.01               # 收敛阈值
  patience: 5                               # 早停耐心值（轮次数）

# 输出路径配置
paths:
  data_path: "data/MNIST"                   # 数据路径
  output_path: "experiments/template_exp"   # 实验输出路径
  log_path: "experiments/template_exp/logs" # 日志路径
  checkpoint_path: "experiments/template_exp/checkpoints"  # 检查点路径

# 检查点配置 (CheckpointHook)
checkpoint:
  enabled: true                             # 启用检查点功能
  save_frequency: 1                         # 保存频率（每N轮保存一次）
  save_model: true                          # 保存模型参数
  save_optimizer: true                      # 保存优化器状态
  save_scheduler: false                     # 保存学习率调度器状态
  save_experiment_state: true               # 保存实验状态
  checkpoint_dir: "experiments/template_exp/checkpoints"  # 检查点目录
  naming_pattern: "checkpoint_round_{round}_epoch_{epoch}"  # 文件命名模式
  include_timestamp: true                   # 文件名包含时间戳
  max_checkpoints: 3                        # 最大保留检查点数量
  keep_best_only: false                     # 是否只保留最佳检查点
  best_metric: "accuracy"                   # 最佳模型评判指标
  best_mode: "max"                          # 最佳模式: max/min

# Hook系统配置
hooks:
  enabled: true                             # 启用Hook系统
  
  # 检查点Hook配置
  checkpoint_hook:
    enabled: true                           # 启用检查点Hook
    phase: "after_round"                    # 执行阶段: before_round/after_round/after_epoch等
    priority: 0                             # 优先级（数字越小优先级越高）
  
  # 自定义Hook配置示例（可选）
  # custom_hooks:
  #   - name: "TensorBoardHook"             # TensorBoard日志Hook
  #     enabled: false
  #     phase: "after_epoch"
  #     priority: 10
  #     config:
  #       log_dir: "runs/"
  #   
  #   - name: "WandBHook"                   # Weights & Biases Hook
  #     enabled: false
  #     phase: "after_round" 
  #     priority: 20
  #     config:
  #       project: "fedcl_experiments"
  #   
  #   - name: "MetricsHook"                 # 指标收集Hook
  #     enabled: true
  #     phase: "after_evaluation"
  #     priority: 5
