# 服务端配置 - 联邦学习服务端配置模板
server:
  id: "fedcl_server"                        # 服务端ID（必须修改）
  name: "FedCL Federation Server"           # 服务端名称
  type: "improved"                          # 服务端类型

# 通信配置
communication:
  host: "localhost"                         # 主机地址
  port: 8080                                # 服务端口
  max_workers: 5                            # 最大工作线程数
  timeout: 60.0                             # 通信超时时间（秒）

# 联邦配置
federation:
  num_rounds: 5                             # 总轮次数（与experiment_config保持一致）
  min_clients: 2                            # 每轮最少客户端数
  max_clients: 3                            # 每轮最多客户端数
  client_selection_strategy: "random"       # 客户端选择策略: random/all
  client_fraction: 1.0                      # 客户端参与比例
  aggregation_strategy: "fedavg"            # 聚合策略: fedavg/fedprox

# 轮次配置
round_config:
  timeout: 120.0                            # 每轮超时时间（秒）
  min_client_updates: 2                     # 最少需要的客户端更新数
  retry_attempts: 2                         # 重试次数
  coordination_timeout: 30.0                # 协调超时时间（秒）

# 聚合器配置
aggregator:
  class: "fedavg"                           # 聚合器类名
  type: "FedAvgAggregator"                  # 聚合器类型
  weighting_strategy: "uniform"             # 权重策略: uniform/sample_size

# 全局模型配置（与客户端模型配置保持一致）
global_model:
  type: "SimpleMLP"                         # 模型类型
  input_size: 784                           # 输入特征维度
  hidden_sizes: [256, 128]                  # 隐藏层大小
  num_classes: 10                           # 分类数量
  dropout_rate: 0.2                         # Dropout比率
  activation: "relu"                        # 激活函数
  use_batch_norm: false                     # 批标准化

# 服务端测试数据配置
test_datas:
  server_test_data:
    type: "StandardDataLoader"              # 数据加载器类型
    batch_size: 64                          # 测试批次大小
    shuffle: false                          # 测试时不打乱
    num_workers: 0                          # 工作线程数
    pin_memory: false                       # 是否固定内存
    dataset:
      name: "MNIST"                         # 数据集名称
      path: "data/MNIST"                    # 数据路径
      split: "test"                         # 使用测试集
      download: true                        # 允许自动下载

# 服务端评估器配置
evaluators:
  server_accuracy_evaluator:                # 服务端准确率评估器
    class: "accuracy"                       # 评估器类名
    phase: "after_aggregation"              # 评估阶段: after_aggregation
    frequency: 1                            # 评估频率
    test_data: "server_test_data"           # 使用的测试数据
    
  server_loss_evaluator:                    # 服务端损失评估器
    class: "loss"                           # 评估器类名
    phase: "after_aggregation"              # 评估阶段
    frequency: 1                            # 评估频率
    test_data: "server_test_data"           # 使用的测试数据

# 服务端评估配置
evaluation:
  enabled: true                             # 启用服务端评估
  tasks:
    - name: "server_evaluation"             # 评估任务名称
      phase: "after_aggregation"            # 在聚合后评估
      evaluators: ["server_accuracy_evaluator", "server_loss_evaluator"]
      test_data: "server_test_data"

# 日志配置
logging:
  level: "INFO"                             # 日志级别
  log_aggregation: true                     # 记录聚合过程
  log_client_updates: true                  # 记录客户端更新
  log_server_evaluation: true               # 记录服务端评估

# 检查点配置
checkpoint:
  enabled: true                             # 启用检查点
  save_frequency: 1                         # 保存频率
  checkpoint_dir: "checkpoints/"            # 检查点目录
  
# 系统配置
system:
  device: "cpu"                             # 设备选择: cpu/cuda
  random_seed: 42                           # 随机种子
