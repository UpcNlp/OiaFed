# ====================================
# FedCL 客户端配置模板
# ====================================
# 客户端配置模板，支持多种learner和异构配置
# 复制此文件为 client_1_config.yaml, client_2_config.yaml 等

# 客户端基本信息
client:
  id: "fedcl_client_1"                     # 客户端唯一标识（请修改）
  name: "FedCL Client 1"                   # 客户端名称（请修改）
  type: "multi_learner"                    # 客户端类型: single_learner/multi_learner
  version: "1.0"                          # 配置版本

# 通信配置
communication:
  host: "localhost"                        # 服务端主机地址
  port: 8080                              # 服务端端口
  max_workers: 3                          # 最大并发工作线程数
  timeout: 60.0                           # 通信超时时间（秒）
  retry_attempts: 3                       # 连接重试次数
  retry_delay: 5.0                        # 重试延迟（秒）
  heartbeat_interval: 30                  # 心跳间隔（秒）

# 学习器配置 - 支持多种learner
learners:
  # 选项1: 默认learner（基础持续学习）
  default_learner:
    class: "default"                       # 学习器类别
    enabled: true                          # 是否启用此learner
    
    # 模型配置
    model:
      type: "SimpleMLP"                    # 模型类型
      input_size: 784                      # 输入特征维度
      hidden_sizes: [256, 128]             # 隐藏层大小
      num_classes: 10                      # 输出类别数
      dropout_rate: 0.2                    # Dropout率
      activation: "relu"                   # 激活函数
      use_batch_norm: false                # 是否使用批归一化
    
    # 优化器配置
    optimizer:
      type: "SGD"                          # 优化器类型: SGD/Adam/AdamW
      lr: 0.01                            # 学习率
      momentum: 0.9                        # 动量（SGD专用）
      weight_decay: 1e-4                   # 权重衰减
      
    # 损失函数配置
    loss_function:
      type: "CrossEntropyLoss"             # 损失函数类型
      
    # 训练配置
    training:
      local_epochs: 5                      # 本地训练轮次
      batch_size: 32                       # 批大小
      
  # 选项2: EWC learner（弹性权重巩固）
  ewc_learner:
    class: "ewc"                           # EWC学习器
    enabled: false                         # 默认关闭，需要时启用
    
    model:
      type: "SimpleMLP"
      input_size: 784
      hidden_sizes: [256, 128]
      num_classes: 10
      dropout_rate: 0.2
    
    optimizer:
      type: "Adam"
      lr: 0.001
      weight_decay: 1e-4
      
    loss_function:
      type: "CrossEntropyLoss"
      
    training:
      local_epochs: 3
      batch_size: 32
      
    # EWC特定配置
    ewc_config:
      lambda_ewc: 0.4                      # EWC正则化系数
      sample_size: 200                     # Fisher信息矩阵采样大小
      
  # 选项3: MAS learner（Memory Aware Synapses）
  mas_learner:
    class: "mas"                           # MAS学习器
    enabled: false                         # 默认关闭
    
    model:
      type: "SimpleMLP"
      input_size: 784
      hidden_sizes: [256, 128]
      num_classes: 10
      dropout_rate: 0.2
    
    optimizer:
      type: "Adam"
      lr: 0.001
      
    loss_function:
      type: "CrossEntropyLoss"
      
    training:
      local_epochs: 3
      batch_size: 32
      
    # MAS特定配置
    mas_config:
      lambda_mas: 0.1                      # MAS正则化系数
      accumulate_gradients: true           # 是否累积梯度
      
  # 选项4: Replay learner（经验回放）
  replay_learner:
    class: "replay"                        # 回放学习器
    enabled: false                         # 默认关闭
    
    model:
      type: "SimpleMLP"
      input_size: 784
      hidden_sizes: [256, 128]
      num_classes: 10
      dropout_rate: 0.2
    
    optimizer:
      type: "Adam"
      lr: 0.001
      
    loss_function:
      type: "CrossEntropyLoss"
      
    training:
      local_epochs: 3
      batch_size: 32
      
    # Replay特定配置
    replay_config:
      buffer_size: 500                     # 回放缓冲区大小
      replay_batch_size: 16                # 回放批大小
      storage_policy: "random"             # 存储策略: random/herding

# 数据配置
training_data:
  client_train_data:
    type: "FederatedDataLoader"            # 联邦数据加载器
    dataset:
      name: "MNIST"                        # 数据集名称
      path: "data/MNIST"                   # 数据集路径
      split: "train"                       # 使用训练集
      download: true                       # 是否自动下载
      transform: "basic"                   # 数据变换: basic/augmented
      
    # 客户端数据分割配置
    federated_config:
      client_id: 1                         # 客户端ID（请修改）
      num_clients: 3                       # 总客户端数
      distribution: "iid"                  # 数据分布: iid/non_iid
      samples_per_client: 1000             # 每个客户端样本数
      # 非IID配置
      non_iid_config:
        alpha: 0.5                         # Dirichlet分布参数
        min_samples_per_class: 10          # 每类最少样本数
    
    # 数据加载器参数
    loader_params:
      batch_size: 32                       # 批大小
      shuffle: true                        # 是否打乱数据
      num_workers: 0                       # 数据加载工作进程数
      drop_last: false                     # 是否丢弃最后不完整batch
      pin_memory: false                    # 是否固定内存

# 测试数据配置
test_data:
  client_test_data:
    type: "StandardDataLoader"
    dataset:
      name: "MNIST"
      path: "data/MNIST"
      split: "test"
      download: true
      transform: "basic"
      
    loader_params:
      batch_size: 128
      shuffle: false
      num_workers: 0
      drop_last: false
      pin_memory: false

# 评估配置
evaluation:
  metrics: ["accuracy", "loss"]            # 评估指标
  frequency: 1                             # 评估频率
  
  # 评估任务
  tasks:
    - evaluator: "client_accuracy_evaluator"
      test_data: "client_test_data"
      enabled: true
    - evaluator: "client_loss_evaluator"
      test_data: "client_test_data"
      enabled: true

# 评估器配置
evaluators:
  client_accuracy_evaluator:
    evaluator:
      class: "accuracy"
      metrics: ["accuracy", "precision", "recall", "f1"]
      test_data: "client_test_data"
      
  client_loss_evaluator:
    evaluator:
      class: "loss"
      loss_function: "cross_entropy"
      test_data: "client_test_data"

# Hook配置
hooks:
  enabled: true                            # 是否启用Hook系统
  
  # 基础Hook
  local_training_hook:
    enabled: true
    priority: 0
    config:
      log_training_progress: true
      
  evaluation_hook:
    enabled: true
    priority: 5
    
  checkpoint_hook:
    enabled: true
    priority: 10
    config:
      save_local_models: true
      
  # 客户端专用Hook
  data_privacy_hook:
    enabled: false                         # 隐私保护Hook
    priority: 1
    config:
      add_noise: false
      noise_scale: 0.1
      
  communication_hook:
    enabled: true
    priority: 15
    config:
      compress_updates: false              # 是否压缩模型更新
      compression_ratio: 0.1               # 压缩比例

# 系统配置
system:
  device: "cpu"                            # 计算设备: cpu/cuda/auto
  random_seed: 42                          # 随机种子
  num_threads: 2                           # CPU线程数
  memory_limit: "4GB"                      # 内存限制
  
  # GPU配置
  gpu_config:
    device_id: 0                           # GPU设备ID
    memory_fraction: 0.5                   # GPU内存使用比例

# 日志配置
logging:
  level: "INFO"                            # 日志级别
  save_logs: true                          # 是否保存日志
  log_frequency: 10                        # 日志频率
  log_dir: "logs/client_1"                 # 日志目录（请修改）
  
  # 日志格式
  formatters:
    default: "[%(asctime)s][CLIENT-1][%(name)s][%(levelname)s] %(message)s"  # 请修改客户端ID
    detailed: "[%(asctime)s][CLIENT-1][%(name)s][%(levelname)s][%(filename)s:%(lineno)d] %(message)s"

# 安全与隐私配置
privacy:
  differential_privacy:
    enabled: false                         # 是否启用差分隐私
    epsilon: 1.0                          # 隐私预算
    delta: 1e-5                           # 隐私参数
    
  secure_aggregation:
    enabled: false                         # 是否启用安全聚合
    
  data_protection:
    encrypt_local_data: false              # 是否加密本地数据
    anonymize_data: false                  # 是否匿名化数据

# 性能配置
performance:
  # 计算优化
  mixed_precision: false                   # 是否使用混合精度
  gradient_compression: false              # 是否压缩梯度
  
  # 通信优化
  model_compression: false                 # 是否压缩模型
  delta_compression: false                 # 是否使用增量压缩
  
  # 资源管理
  max_memory_usage: "2GB"                  # 最大内存使用
  max_cpu_usage: 80                        # 最大CPU使用率(%)

# 多任务学习配置（可选）
continual_learning:
  enabled: false                           # 是否启用持续学习
  
  task_sequence:
    num_tasks: 5                           # 任务数量
    task_type: "split"                     # 任务类型: split/permuted/incremental
    classes_per_task: 2                    # 每个任务的类别数
    
  memory_management:
    replay_buffer_size: 1000               # 回放缓冲区大小
    exemplar_selection: "random"           # 样本选择策略
    
# 实验配置
experiment:
  name: "client_template_experiment"       # 实验名称
  description: "FedCL客户端配置模板实验"    # 实验描述
  output_dir: "experiments/client_template" # 输出目录
  client_specific_dir: true                # 是否创建客户端特定目录
