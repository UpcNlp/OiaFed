# ====================================
# FedCL 客户端2配置
# ====================================
# 客户端2使用EWC learner进行持续学习

# 客户端基本信息
client:
  id: "fedcl_client_2"                     # 客户端2唯一标识
  name: "FedCL Client 2"                   # 客户端2名称
  type: "multi_learner"

# 通信配置
communication:
  host: "localhost"
  port: 8080
  max_workers: 3
  timeout: 60.0

# 学习器配置 - 启用EWC learner
learners:
  ewc_learner:
    class: "ewc"                           # 使用EWC learner
    enabled: true                          # 启用EWC learner
    
    model:
      type: "SimpleMLP"
      input_size: 784
      hidden_sizes: [256, 128]
      num_classes: 10
      dropout_rate: 0.2
      activation: "relu"
      use_batch_norm: false
    
    optimizer:
      type: "Adam"                         # 客户端2使用Adam优化器
      lr: 0.001                           # 较小的学习率适合EWC
      weight_decay: 1e-4
      
    loss_function:
      type: "CrossEntropyLoss"
      
    training:
      local_epochs: 3                      # EWC使用较少本地轮次
      batch_size: 32
      
    # EWC特定配置
    ewc_config:
      lambda_ewc: 0.4                      # EWC正则化系数
      sample_size: 200                     # Fisher信息矩阵采样大小

# 数据配置 - 客户端2数据（可以设置为非IID）
training_data:
  client_train_data:
    type: "FederatedDataLoader"
    dataset:
      name: "MNIST"
      path: "data/MNIST"
      split: "train"
      download: true
      transform: "basic"
      
    federated_config:
      client_id: 2                         # 客户端2
      num_clients: 3
      distribution: "non_iid"              # 客户端2使用非IID数据
      samples_per_client: 1000
      non_iid_config:
        alpha: 0.5                         # Dirichlet分布参数
        min_samples_per_class: 10
    
    loader_params:
      batch_size: 32
      shuffle: true
      num_workers: 0

# 测试数据配置
test_data:
  client_test_data:
    type: "StandardDataLoader"
    dataset:
      name: "MNIST"
      path: "data/MNIST"
      split: "test"
      download: true
      transform: "basic"
      
    loader_params:
      batch_size: 128
      shuffle: false
      num_workers: 0

# 评估配置
evaluation:
  metrics: ["accuracy", "loss", "forgetting"]  # EWC关注遗忘指标
  frequency: 1
  
  tasks:
    - evaluator: "client_accuracy_evaluator"
      test_data: "client_test_data"
      enabled: true

# 评估器配置
evaluators:
  client_accuracy_evaluator:
    evaluator:
      class: "accuracy"
      metrics: ["accuracy", "precision", "recall", "f1"]
      test_data: "client_test_data"

# Hook配置 - 添加EWC专用Hook
hooks:
  enabled: true
  
  local_training_hook:
    enabled: true
    priority: 0
    
  ewc_regularization_hook:               # EWC专用Hook
    enabled: true
    priority: 1
    config:
      update_fisher_frequency: 5           # 每5轮更新Fisher信息矩阵
    
  evaluation_hook:
    enabled: true
    priority: 5
    
  communication_hook:
    enabled: true
    priority: 15

# 系统配置
system:
  device: "cpu"
  random_seed: 43                          # 不同的随机种子
  num_threads: 2

# 日志配置 - 客户端2专用
logging:
  level: "INFO"
  save_logs: true
  log_dir: "logs/client_2"                 # 客户端2日志目录
  
  formatters:
    default: "[%(asctime)s][CLIENT-2][%(name)s][%(levelname)s] %(message)s"

# 实验配置
experiment:
  name: "client_2_ewc_experiment"
  description: "客户端2 EWC learner实验配置"
  output_dir: "experiments/client_2"
