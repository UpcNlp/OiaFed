# MOE-FedCL è”é‚¦é€šä¿¡ç³»ç»Ÿè¯¦ç»†æ¶æ„è®¾è®¡

## 1. æ€»ä½“æ¶æ„è®¾è®¡

### 1.1 äº”å±‚æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ç¬¬0å±‚ï¼šè”é‚¦å­¦ä¹ ç»Ÿä¸€å…¥å£                           â”‚
â”‚                  (è”é‚¦å­¦ä¹ åè°ƒå™¨)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              FederationCoordinator                         â”‚ â”‚
â”‚  â”‚               (è”é‚¦å­¦ä¹ åè°ƒå™¨)                              â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚  â€¢ è”é‚¦å­¦ä¹ ç»Ÿä¸€å…¥å£                                         â”‚ â”‚
â”‚  â”‚  â€¢ è®­ç»ƒè½®æ¬¡åè°ƒç®¡ç†                                         â”‚ â”‚
â”‚  â”‚  â€¢ å…¨å±€çŠ¶æ€ç›‘æ§                                           â”‚ â”‚
â”‚  â”‚  â€¢ è®­ç»ƒæµç¨‹ç¼–æ’                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ç¬¬1å±‚ï¼šæœåŠ¡ç«¯ä¸šåŠ¡æŠ½è±¡å±‚                            â”‚
â”‚                 (è”é‚¦è®­ç»ƒå™¨æŠ½è±¡)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  BaseTrainer    â”‚    â”‚  CustomTrainer1 â”‚    â”‚CustomTrainer2â”‚ â”‚
â”‚  â”‚  (æŠ½è±¡åŸºç±»)     â”‚    â”‚  (ç”¨æˆ·å®ç°)     â”‚    â”‚ (ç”¨æˆ·å®ç°)   â”‚  â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚    â”‚             â”‚  â”‚
â”‚  â”‚  ç®—æ³•æ¥å£å®šä¹‰   â”‚    â”‚  FedAvgç®—æ³•     â”‚    â”‚ FedProxç®—æ³• â”‚  â”‚
â”‚  â”‚  æµç¨‹æ§åˆ¶       â”‚    â”‚  æ¨¡å‹èšåˆ       â”‚    â”‚ è¿‘ç«¯ä¼˜åŒ–    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                   â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ç¬¬2å±‚ï¼šä¸šåŠ¡é€šä¿¡å±‚                                 â”‚
â”‚              (è”é‚¦å­¦ä¹ ä¸“ç”¨é€šä¿¡)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  LearnerProxy       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  LearnerStub        â”‚   â”‚
â”‚  â”‚  (å®¢æˆ·ç«¯å­¦ä¹ å™¨ä»£ç†)  â”‚              â”‚  (æœåŠ¡ç«¯å­¦ä¹ å™¨å­˜æ ¹)  â”‚   â”‚
â”‚  â”‚                     â”‚              â”‚                     â”‚   â”‚
â”‚  â”‚ â€¢ è¿œç¨‹è®­ç»ƒè°ƒç”¨      â”‚              â”‚ â€¢ RPCè¯·æ±‚å¤„ç†      â”‚   â”‚
â”‚  â”‚ â€¢ æ¨¡å‹è·å–/è®¾ç½®     â”‚              â”‚ â€¢ ä¸šåŠ¡é€»è¾‘åˆ†å‘     â”‚   â”‚
â”‚  â”‚ â€¢ æ¨é€äº‹ä»¶è®¢é˜…      â”‚              â”‚ â€¢ æ¨¡å‹å¹¿æ’­æ¨é€     â”‚   â”‚
â”‚  â”‚ â€¢ æ–¹æ³•è°ƒç”¨å°è£…      â”‚              â”‚ â€¢ å“åº”ç”Ÿæˆè¿”å›     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ç¬¬3å±‚ï¼šè¿æ¥ç®¡ç†å±‚                                  â”‚
â”‚             (è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              ConnectionManager                          â”‚   â”‚
â”‚  â”‚               (è¿æ¥ç®¡ç†å™¨)                              â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚ ConnectionPool  â”‚      â”‚ MessageRouter   â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  (è¿æ¥æ± )       â”‚      â”‚  (æ¶ˆæ¯è·¯ç”±å™¨)   â”‚          â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚      â”‚                 â”‚          â”‚   â”‚
â”‚  â”‚  â”‚â€¢ è¿æ¥å»ºç«‹ç»´æŠ¤   â”‚      â”‚â€¢ æ¶ˆæ¯ç±»å‹è¯†åˆ«  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚â€¢ å¥åº·æ£€æµ‹      â”‚      â”‚â€¢ è·¯ç”±è§„åˆ™ç®¡ç†  â”‚          â”‚   â”‚
â”‚  â”‚  â”‚â€¢ é‡è¿ç­–ç•¥      â”‚      â”‚â€¢ è´Ÿè½½å‡è¡¡     â”‚          â”‚   â”‚
â”‚  â”‚  â”‚â€¢ èµ„æºæ¸…ç†      â”‚      â”‚â€¢ å®¹é”™å¤„ç†     â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ç¬¬4å±‚ï¼šé€šç”¨é€šä¿¡å±‚                                  â”‚
â”‚             (åŸºç¡€é€šä¿¡æœåŠ¡)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ CommunicationManagerâ”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  ControlService     â”‚   â”‚
â”‚  â”‚  (é€šç”¨é€šä¿¡ç®¡ç†å™¨)   â”‚              â”‚  (æ§åˆ¶æœåŠ¡)         â”‚   â”‚
â”‚  â”‚                     â”‚              â”‚                     â”‚   â”‚
â”‚  â”‚ â€¢ å®¢æˆ·ç«¯æ³¨å†Œç®¡ç†    â”‚              â”‚ â€¢ æ³¨å†ŒæœåŠ¡         â”‚   â”‚
â”‚  â”‚ â€¢ å¿ƒè·³ä¿æ´»æœºåˆ¶      â”‚              â”‚ â€¢ å¿ƒè·³ç›‘æ§         â”‚   â”‚
â”‚  â”‚ â€¢ çŠ¶æ€æŸ¥è¯¢åŒæ­¥      â”‚              â”‚ â€¢ çŠ¶æ€ç®¡ç†         â”‚   â”‚
â”‚  â”‚ â€¢ é€šç”¨æ¶ˆæ¯è·¯ç”±      â”‚              â”‚ â€¢ äº‹ä»¶é€šçŸ¥         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ç¬¬5å±‚ï¼šä¼ è¾“æŠ½è±¡å±‚                                  â”‚
â”‚            (è·¨æ¨¡å¼ä¼ è¾“æŠ½è±¡)                                     â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                â”‚        TransportBase           â”‚               â”‚
â”‚                â”‚        (ä¼ è¾“æ¥å£)              â”‚               â”‚
â”‚                â”‚                                 â”‚               â”‚
â”‚                â”‚ â€¢ ç»Ÿä¸€ä¼ è¾“æ¥å£                 â”‚               â”‚
â”‚                â”‚ â€¢ Source/Targetè·¯ç”±            â”‚               â”‚
â”‚                â”‚ â€¢ åŒå‘é€šä¿¡æ”¯æŒ                 â”‚               â”‚
â”‚                â”‚ â€¢ è¿æ¥äº‹ä»¶å¤„ç†                 â”‚               â”‚
â”‚                â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚       â”‚MemoryTransport  â”‚ â”‚Process  â”‚ â”‚NetworkTransport â”‚       â”‚
â”‚       â”‚(å†…å­˜ä¼ è¾“)       â”‚ â”‚Transportâ”‚ â”‚(ç½‘ç»œä¼ è¾“)       â”‚       â”‚
â”‚       â”‚                 â”‚ â”‚(è¿›ç¨‹ä¼ è¾“)â”‚ â”‚                 â”‚       â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ­£ç¡®çš„æ ¸å¿ƒé€šä¿¡æµç¨‹

#### å®¢æˆ·ç«¯å¯åŠ¨æ³¨å†Œæµç¨‹
```
ğŸ‘¤ å®¢æˆ·ç«¯å¯åŠ¨ (BaseLearner + LearnerStub)
    â†“
ğŸ”„ LearnerStub.start_listening()
    â†“ å®¢æˆ·ç«¯æ³¨å†Œ
âš¡ CommunicationManager.register_client()
    â†“ æ³¨å†Œè¯·æ±‚å‘é€
ğŸ”— ConnectionManager â†’ TransportBase
    â†“ è·¨æ¨¡å¼ä¼ è¾“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• åˆ°è¾¾æœåŠ¡ç«¯ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ–¥ï¸ æœåŠ¡ç«¯CommunicationManager.handle_registration()
    â†“ å¤„ç†æ³¨å†Œè¯·æ±‚
ğŸ“ å®¢æˆ·ç«¯æ³¨å†ŒæˆåŠŸï¼Œå¼€å§‹ç›‘å¬æœåŠ¡ç«¯è¯·æ±‚
```

#### è”é‚¦è®­ç»ƒæ‰§è¡Œæµç¨‹
```
ğŸ“ è”é‚¦å­¦ä¹ ç»Ÿä¸€å…¥å£ (FederationCoordinator)
    â†“ å¯åŠ¨è”é‚¦è®­ç»ƒ/åè°ƒè®­ç»ƒè½®æ¬¡
ğŸ–¥ï¸ æœåŠ¡ç«¯è®­ç»ƒå™¨ (BaseTrainer - ç”¨æˆ·ç»§æ‰¿å®ç°)
    â†“ æ‰§è¡Œè”é‚¦ç®—æ³•/è°ƒç”¨å®¢æˆ·ç«¯è®­ç»ƒ
    â†“ learner_proxies[client_id].train(params)
ğŸ”„ å­¦ä¹ å™¨ä»£ç† (LearnerProxy)
    â†“ ä¸šåŠ¡é€šä¿¡å°è£…/è¿œç¨‹æ–¹æ³•è°ƒç”¨
âš¡ é€šç”¨é€šä¿¡ç®¡ç† (CommunicationManager)
    â†“ è¿æ¥ç®¡ç†/æ¶ˆæ¯è·¯ç”±
ğŸ”— è¿æ¥ç®¡ç†å™¨ (ConnectionManager)
    â†“ ä¼ è¾“æŠ½è±¡/è·¯ç”±é€‰æ‹©
ğŸš€ ä¼ è¾“å±‚ (TransportBase)
    â†“ è·¨æ¨¡å¼ä¼ è¾“(Memory/Process/Network)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ç½‘ç»œ/è¿›ç¨‹è¾¹ç•Œ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ ä¼ è¾“å±‚ (TransportBase)
    â†“ æ¥æ”¶è¯·æ±‚/æ¶ˆæ¯ååºåˆ—åŒ–
ğŸ”— è¿æ¥ç®¡ç†å™¨ (ConnectionManager)
    â†“ è¯·æ±‚è·¯ç”±/è¿æ¥éªŒè¯
âš¡ é€šç”¨é€šä¿¡ç®¡ç† (CommunicationManager)
    â†“ ä¸šåŠ¡åˆ†å‘/è¯·æ±‚å¤„ç†
ğŸ”„ å­¦ä¹ å™¨å­˜æ ¹ (LearnerStub)
    â†“ è°ƒç”¨æœ¬åœ°å­¦ä¹ å™¨/å‚æ•°éªŒè¯
ğŸ‘¤ å®¢æˆ·ç«¯å­¦ä¹ å™¨ (BaseLearner - ç”¨æˆ·ç»§æ‰¿å®ç°)
    â†“ æ‰§è¡Œæœ¬åœ°è®­ç»ƒ/è¿”å›ç»“æœ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ç»“æœè¿”å›è·¯å¾„(åŸè·¯å¾„è¿”å›) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ–¥ï¸ æœåŠ¡ç«¯è®­ç»ƒå™¨ (BaseTrainer)
    â†“ æ¥æ”¶è®­ç»ƒç»“æœ/æ‰§è¡Œæ¨¡å‹èšåˆ
ğŸ“ è”é‚¦å­¦ä¹ ç»Ÿä¸€å…¥å£ (FederationCoordinator)
    â†“ åè°ƒä¸‹ä¸€è½®è®­ç»ƒ/æ›´æ–°å…¨å±€çŠ¶æ€
```

### 1.3 æ ¸å¿ƒè®¾è®¡åŸåˆ™

**1. ç»Ÿä¸€å…¥å£åŸåˆ™**
- **è”é‚¦åè°ƒå™¨**ï¼šä½œä¸ºæ•´ä¸ªè”é‚¦å­¦ä¹ çš„ç»Ÿä¸€å…¥å£å’Œæµç¨‹åè°ƒ
- **è®­ç»ƒå™¨æŠ½è±¡**ï¼šç”¨æˆ·å®ç°å…·ä½“çš„è”é‚¦ç®—æ³•ï¼Œæ— éœ€å…³å¿ƒé€šä¿¡ç»†èŠ‚
- **ä»£ç†æ¨¡å¼å°è£…**ï¼šé€šè¿‡ä»£ç†æ¨¡å¼å°è£…è¿œç¨‹è°ƒç”¨å¤æ‚æ€§

**2. èŒè´£åˆ†ç¦»åŸåˆ™**
- **ä¸šåŠ¡é€šä¿¡å±‚**ï¼šä¸“æ³¨è”é‚¦å­¦ä¹ ä¸šåŠ¡é€»è¾‘ï¼Œå¦‚è®­ç»ƒè°ƒç”¨ã€æ¨¡å‹ä¼ è¾“
- **é€šç”¨é€šä¿¡å±‚**ï¼šä¸“æ³¨åŸºç¡€é€šä¿¡æœåŠ¡ï¼Œå¦‚æ³¨å†Œã€å¿ƒè·³ã€çŠ¶æ€ç®¡ç†
- **è¿æ¥ç®¡ç†å±‚**ï¼šä¸“æ³¨è¿æ¥ç”Ÿå‘½å‘¨æœŸå’Œæ¶ˆæ¯è·¯ç”±
- **ä¼ è¾“æŠ½è±¡å±‚**ï¼šä¸“æ³¨è·¨æ¨¡å¼ä¼ è¾“å®ç°

**3. æŠ½è±¡æ¥å£åŸåˆ™**
- æ¯å±‚å®šä¹‰æ¸…æ™°çš„æŠ½è±¡æ¥å£
- æ”¯æŒä¾èµ–æ³¨å…¥å’Œç­–ç•¥æ¨¡å¼
- å®ç°å¯æ›¿æ¢æ€§å’Œå¯æ‰©å±•æ€§

**4. ç»Ÿä¸€è·¯ç”±åŸåˆ™**
- Source/Targetæ ‡è¯†ç¬¦ç»Ÿä¸€ç®¡ç†
- è·¨æ¨¡å¼è·¯ç”±è§„åˆ™ä¸€è‡´
- åŒå‘é€šä¿¡æ”¯æŒå®Œæ•´

## 2. æ–‡ä»¶ç»“æ„è®¾è®¡

```
moe_fedcl/
â”œâ”€â”€ ğŸ“ moe_fedcl/                          # ä¸»åŒ…ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”œâ”€â”€ ğŸ“„ exceptions.py                   # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”œâ”€â”€ ğŸ“„ types.py                        # ç±»å‹å®šä¹‰å’Œæšä¸¾
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ federation/                     # ğŸ¯ è”é‚¦å­¦ä¹ ç»Ÿä¸€å…¥å£
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â””â”€â”€ ğŸ“„ coordinator.py              # è”é‚¦å­¦ä¹ åè°ƒå™¨ï¼ˆç»Ÿä¸€å…¥å£ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ trainer/                       # ğŸ–¥ï¸ æœåŠ¡ç«¯ä¸šåŠ¡æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â””â”€â”€ ğŸ“„ base_trainer.py             # ç”¨æˆ·ç»§æ‰¿çš„è”é‚¦è®­ç»ƒå™¨åŸºç±»
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ learner/                       # ğŸ‘¤ å®¢æˆ·ç«¯ä¸šåŠ¡æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ base_learner.py             # ç”¨æˆ·ç»§æ‰¿çš„å­¦ä¹ å™¨åŸºç±»
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ proxy.py                    # LearnerProxyç»Ÿä¸€ä»£ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ stub.py                     # LearnerStubç»Ÿä¸€å­˜æ ¹
â”‚   â”‚   â””â”€â”€ ğŸ“„ subscription.py             # äº‹ä»¶è®¢é˜…ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ connection/                     # ğŸ”— ç¬¬3å±‚ï¼šè¿æ¥ç®¡ç†å±‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ manager.py                  # ConnectionManagerç»Ÿä¸€ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ pool.py                     # è¿æ¥æ± ç®¡ç†
â”‚   â”‚   â””â”€â”€ ğŸ“„ router.py                   # æ¶ˆæ¯è·¯ç”±å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ communication/                  # âš¡ ç¬¬4å±‚ï¼šé€šç”¨é€šä¿¡å±‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ base.py                     # CommunicationManageræŠ½è±¡åŸºç±»
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ memory_manager.py           # Memoryæ¨¡å¼é€šä¿¡ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ process_manager.py          # Processæ¨¡å¼é€šä¿¡ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ network_manager.py          # Networkæ¨¡å¼é€šä¿¡ç®¡ç†å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“ services/                   # é€šä¿¡æœåŠ¡ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ registry.py             # å®¢æˆ·ç«¯æ³¨å†ŒæœåŠ¡
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ heartbeat.py            # å¿ƒè·³æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ ğŸ“„ status.py               # çŠ¶æ€ç®¡ç†æœåŠ¡
â”‚   â”‚       â””â”€â”€ ğŸ“„ security.py             # å®‰å…¨è®¤è¯æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ transport/                      # ğŸš€ ç¬¬5å±‚ï¼šä¼ è¾“æŠ½è±¡å±‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ base.py                     # TransportBaseæŠ½è±¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ memory.py                   # MemoryTransportå®ç°
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ process.py                  # ProcessTransportå®ç°
â”‚   â”‚   â””â”€â”€ ğŸ“„ network.py                  # NetworkTransportå®ç°
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ factory/                       # ğŸ­ å·¥å‚æ¨¡å¼
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ base.py                     # ComponentFactoryæŠ½è±¡åŸºç±»
â”‚   â”‚   â””â”€â”€ ğŸ“„ factory.py                  # ç»Ÿä¸€ç»„ä»¶å·¥å‚
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ config/                        # âš™ï¸ é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ __init__.py
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ manager.py                  # é…ç½®ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ ğŸ“„ validator.py                # é…ç½®éªŒè¯å™¨
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ utils/                         # ğŸ”§ å·¥å…·ç±»
â”‚       â”œâ”€â”€ ğŸ“„ __init__.py
â”‚       â”œâ”€â”€ ğŸ“„ serialization.py           # åºåˆ—åŒ–å·¥å…·
â”‚       â”œâ”€â”€ ğŸ“„ retry.py                    # é‡è¯•æœºåˆ¶
â”‚       â””â”€â”€ ğŸ“„ logging.py                  # æ—¥å¿—å·¥å…·
â”‚
â”œâ”€â”€ ğŸ“ configs/                           # âš™ï¸ é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“„ global.yaml                     # å…¨å±€é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ memory.yaml                     # Memoryæ¨¡å¼é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ process.yaml                    # Processæ¨¡å¼é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ network.yaml                    # Networkæ¨¡å¼é…ç½®
â”‚   â””â”€â”€ ğŸ“„ federation.yaml                 # è”é‚¦å­¦ä¹ é…ç½®
â”‚
â”œâ”€â”€ ğŸ“„ requirements.txt                    # æ ¸å¿ƒä¾èµ–
â”œâ”€â”€ ğŸ“„ setup.py                           # å®‰è£…é…ç½®
â”œâ”€â”€ ğŸ“„ README.md                          # é¡¹ç›®è¯´æ˜
â””â”€â”€ ğŸ“„ LICENSE                            # å¼€æºè®¸å¯
```

## 3. è”é‚¦å­¦ä¹ ç»Ÿä¸€å…¥å£è®¾è®¡

### 3.1 FederationCoordinatorè®¾è®¡

**æ ¸å¿ƒèŒè´£**ï¼šä½œä¸ºè”é‚¦å­¦ä¹ çš„ç»Ÿä¸€å…¥å£å’Œæµç¨‹åè°ƒå™¨

**å…³é”®ç‰¹æ€§**ï¼š
- è”é‚¦å­¦ä¹ çš„å”¯ä¸€å¯åŠ¨å…¥å£
- è®­ç»ƒè½®æ¬¡çš„åè°ƒç®¡ç†
- å…¨å±€çŠ¶æ€ç›‘æ§å’Œæ§åˆ¶
- è®­ç»ƒæµç¨‹ç¼–æ’å’Œå¼‚å¸¸å¤„ç†
- è·¨æ¨¡å¼è¿è¡Œæ”¯æŒ

**æ¥å£è§„èŒƒ**ï¼š

```
FederationCoordinator
â”œâ”€â”€ åˆå§‹åŒ–å‚æ•°
â”‚   â”œâ”€â”€ trainer: BaseTrainer (ç”¨æˆ·è‡ªå®šä¹‰è®­ç»ƒå™¨)
â”‚   â”œâ”€â”€ clients_config: Dict (å®¢æˆ·ç«¯é…ç½®ä¿¡æ¯)
â”‚   â”œâ”€â”€ federation_config: FederationConfig (è”é‚¦é…ç½®)
â”‚   â””â”€â”€ communication_config: CommunicationConfig (é€šä¿¡é…ç½®)
â”‚
â”œâ”€â”€ æ ¸å¿ƒåè°ƒæ–¹æ³•
â”‚   â”œâ”€â”€ async start_federation() -> FederationResult
â”‚   â”œâ”€â”€ async stop_federation() -> bool
â”‚   â”œâ”€â”€ async pause_federation() -> bool
â”‚   â”œâ”€â”€ async resume_federation() -> bool
â”‚   â””â”€â”€ async reset_federation() -> bool
â”‚
â”œâ”€â”€ è®­ç»ƒæ§åˆ¶æ–¹æ³•
â”‚   â”œâ”€â”€ async run_training_round(round_num: int) -> RoundResult
â”‚   â”œâ”€â”€ async get_global_model() -> ModelData
â”‚   â”œâ”€â”€ async set_global_model(model_data: ModelData) -> bool
â”‚   â””â”€â”€ async get_federation_status() -> FederationStatus
â”‚
â”œâ”€â”€ å®¢æˆ·ç«¯ç®¡ç†æ–¹æ³•
â”‚   â”œâ”€â”€ async register_clients() -> Dict[str, bool]
â”‚   â”œâ”€â”€ async get_active_clients() -> List[str]
â”‚   â”œâ”€â”€ async check_client_readiness() -> Dict[str, bool]
â”‚   â””â”€â”€ async wait_for_clients(timeout: float) -> bool
â”‚
â””â”€â”€ äº‹ä»¶ç®¡ç†æ–¹æ³•
    â”œâ”€â”€ register_round_callback(callback: Callable) -> str
    â”œâ”€â”€ register_federation_callback(callback: Callable) -> str
    â””â”€â”€ unregister_callback(callback_id: str) -> bool
```

## 4. æœåŠ¡ç«¯è®­ç»ƒå™¨æŠ½è±¡è®¾è®¡

### 4.1 BaseTraineræŠ½è±¡æ¥å£è®¾è®¡

**æ ¸å¿ƒèŒè´£**ï¼šå®šä¹‰è”é‚¦è®­ç»ƒç®—æ³•çš„æŠ½è±¡æ¥å£ï¼Œç”¨æˆ·ç»§æ‰¿å®ç°å…·ä½“ç®—æ³•

**å…³é”®ç‰¹æ€§**ï¼š
- è”é‚¦ç®—æ³•çš„æŠ½è±¡å®šä¹‰
- é€šè¿‡learner_proxiesç›´æ¥è°ƒç”¨è¿œç¨‹å®¢æˆ·ç«¯(å¦‚learner_proxies[client_id].train())
- æ¨¡å‹èšåˆå’Œå‚æ•°æ›´æ–°é€»è¾‘
- è®­ç»ƒçŠ¶æ€ç®¡ç†å’Œç»“æœæ”¶é›†

**æ¥å£è§„èŒƒ**ï¼š

```
BaseTrainer (æŠ½è±¡åŸºç±»)
â”œâ”€â”€ åˆå§‹åŒ–å‚æ•°
â”‚   â”œâ”€â”€ learner_proxies: Dict[str, LearnerProxy] (å®¢æˆ·ç«¯ä»£ç†æ˜ å°„)
â”‚   â”œâ”€â”€ global_model: ModelData (å…¨å±€æ¨¡å‹)
â”‚   â”œâ”€â”€ training_config: TrainingConfig (è®­ç»ƒé…ç½®)
â”‚   â””â”€â”€ logger: Logger (æ—¥å¿—è®°å½•å™¨)
â”‚
â”œâ”€â”€ æ ¸å¿ƒè®­ç»ƒæ–¹æ³• (ç”¨æˆ·å¿…é¡»å®ç°)
â”‚   â”œâ”€â”€ async train_round(round_num: int, client_ids: List[str]) -> RoundResult
â”‚   â”œâ”€â”€ async aggregate_models(client_results: Dict[str, ModelUpdate]) -> ModelData
â”‚   â”œâ”€â”€ async evaluate_global_model() -> EvaluationResult
â”‚   â””â”€â”€ should_stop_training(round_num: int, round_result: RoundResult) -> bool
â”‚
â”œâ”€â”€ çŠ¶æ€ç®¡ç†æ–¹æ³• (æ¡†æ¶æä¾›)
â”‚   â”œâ”€â”€ get_training_status() -> TrainingStatus
â”‚   â”œâ”€â”€ get_round_statistics() -> RoundStatistics
â”‚   â”œâ”€â”€ get_client_statistics() -> Dict[str, ClientStatistics]
â”‚   â””â”€â”€ save_checkpoint(checkpoint_path: str) -> bool
â”‚
â””â”€â”€ ç”Ÿå‘½å‘¨æœŸæ–¹æ³• (æ¡†æ¶æä¾›)
    â”œâ”€â”€ async initialize() -> bool
    â”œâ”€â”€ async cleanup() -> None
    â””â”€â”€ async handle_client_failure(client_id: str) -> None
```

**LearnerProxyè¿œç¨‹è°ƒç”¨æ¨¡å¼**ï¼š
ç”¨æˆ·åœ¨train_roundæ–¹æ³•ä¸­ç›´æ¥é€šè¿‡learner_proxiesè°ƒç”¨è¿œç¨‹å®¢æˆ·ç«¯ï¼š
- `result = await self.learner_proxies[client_id].train(params)` - è°ƒç”¨è¿œç¨‹è®­ç»ƒ
- `model = await self.learner_proxies[client_id].get_model()` - è·å–å®¢æˆ·ç«¯æ¨¡å‹  
- `eval_result = await self.learner_proxies[client_id].evaluate(params)` - è¿œç¨‹è¯„ä¼°
- `await self.learner_proxies[client_id].set_model(global_model)` - è®¾ç½®å…¨å±€æ¨¡å‹

## 5. å®¢æˆ·ç«¯å­¦ä¹ å™¨å’Œä»£ç†è¯¦ç»†è®¾è®¡

### 5.1 BaseLearneræŠ½è±¡æ¥å£è®¾è®¡

**æ ¸å¿ƒèŒè´£**ï¼šå®šä¹‰å®¢æˆ·ç«¯æœ¬åœ°å­¦ä¹ çš„æŠ½è±¡æ¥å£ï¼Œç”¨æˆ·ç»§æ‰¿å®ç°å…·ä½“è®­ç»ƒé€»è¾‘

**å…³é”®ç‰¹æ€§**ï¼š
- æœ¬åœ°è®­ç»ƒé€»è¾‘æŠ½è±¡
- æ¨¡å‹è·å–å’Œæ›´æ–°æ¥å£
- æœ¬åœ°è¯„ä¼°å’ŒæŒ‡æ ‡è®¡ç®—
- ä¸LearnerStubé…åˆå¤„ç†æœåŠ¡ç«¯è¯·æ±‚

**æ¥å£è§„èŒƒ**ï¼š

```
BaseLearner (æŠ½è±¡åŸºç±»)
â”œâ”€â”€ åˆå§‹åŒ–å‚æ•°
â”‚   â”œâ”€â”€ client_id: str (å®¢æˆ·ç«¯å”¯ä¸€æ ‡è¯†)
â”‚   â”œâ”€â”€ local_data: DataSet (æœ¬åœ°æ•°æ®é›†)
â”‚   â”œâ”€â”€ model_config: ModelConfig (æ¨¡å‹é…ç½®)
â”‚   â””â”€â”€ training_config: TrainingConfig (è®­ç»ƒé…ç½®)
â”‚
â”œâ”€â”€ æ ¸å¿ƒè®­ç»ƒæ–¹æ³• (ç”¨æˆ·å¿…é¡»å®ç°)
â”‚   â”œâ”€â”€ async train(training_params: Dict) -> TrainingResult
â”‚   â”œâ”€â”€ async evaluate(evaluation_params: Dict) -> EvaluationResult
â”‚   â”œâ”€â”€ async get_local_model() -> ModelData
â”‚   â””â”€â”€ async set_local_model(model_data: ModelData) -> bool
â”‚
â”œâ”€â”€ æ•°æ®ç®¡ç†æ–¹æ³• (å¯é€‰å®ç°)
â”‚   â”œâ”€â”€ get_data_statistics() -> DataStatistics
â”‚   â”œâ”€â”€ prepare_training_data(batch_size: int) -> DataLoader
â”‚   â””â”€â”€ prepare_evaluation_data() -> DataLoader
â”‚
â”œâ”€â”€ æ¨¡å‹ç®¡ç†æ–¹æ³• (æ¡†æ¶æä¾›é»˜è®¤å®ç°)
â”‚   â”œâ”€â”€ save_model(model_path: str) -> bool
â”‚   â”œâ”€â”€ load_model(model_path: str) -> ModelData
â”‚   â””â”€â”€ get_model_parameters() -> Dict[str, Any]
â”‚
â””â”€â”€ ç”Ÿå‘½å‘¨æœŸæ–¹æ³• (æ¡†æ¶æä¾›)
    â”œâ”€â”€ async initialize() -> bool
    â”œâ”€â”€ async cleanup() -> None
    â””â”€â”€ get_learner_info() -> LearnerInfo
```

### 5.2 LearnerProxyç»Ÿä¸€ä»£ç†è®¾è®¡

**æ ¸å¿ƒèŒè´£**ï¼šå°è£…æœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯çš„è¿œç¨‹è°ƒç”¨ï¼Œæä¾›ç»Ÿä¸€çš„ä¸šåŠ¡æ¥å£

**å…³é”®ç‰¹æ€§**ï¼š
- ç»Ÿä¸€çš„è¿œç¨‹è°ƒç”¨æ¥å£
- å†…éƒ¨æ ¹æ®é…ç½®é€‰æ‹©å¯¹åº”çš„CommunicationManager
- æ”¯æŒå¼‚æ­¥RPCè°ƒç”¨å’Œäº‹ä»¶è®¢é˜…
- æ”¯æŒè¶…æ—¶å’Œé‡è¯•æœºåˆ¶
- æ¨¡å¼åˆ‡æ¢å¯¹ç”¨æˆ·é€æ˜

**æ¥å£è§„èŒƒ**ï¼š

```
LearnerProxy (ç»Ÿä¸€ä»£ç†ç±»)
â”œâ”€â”€ åˆå§‹åŒ–å‚æ•°
â”‚   â”œâ”€â”€ client_id: str (å®¢æˆ·ç«¯å”¯ä¸€æ ‡è¯†)
â”‚   â”œâ”€â”€ communication_manager: CommunicationManager (é€šä¿¡ç®¡ç†å™¨)
â”‚   â”œâ”€â”€ connection_manager: ConnectionManager (è¿æ¥ç®¡ç†å™¨)
â”‚   â””â”€â”€ config: ProxyConfig (ä»£ç†é…ç½®)
â”‚
â”œâ”€â”€ æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•
â”‚   â”œâ”€â”€ async train(training_params: Dict) -> TrainingResult
â”‚   â”œâ”€â”€ async evaluate(evaluation_params: Dict) -> EvaluationResult
â”‚   â”œâ”€â”€ async get_model() -> ModelData
â”‚   â”œâ”€â”€ async set_model(model_data: ModelData) -> bool
â”‚   â”œâ”€â”€ async get_metrics() -> MetricsData
â”‚   â””â”€â”€ async call_remote_method(method_name: str, **kwargs) -> Any
â”‚
â”œâ”€â”€ æ¨é€è®¢é˜…æ–¹æ³•
â”‚   â”œâ”€â”€ subscribe_training_events(callback: Callable) -> str
â”‚   â”œâ”€â”€ subscribe_model_updates(callback: Callable) -> str
â”‚   â”œâ”€â”€ unsubscribe(subscription_id: str) -> bool
â”‚   â””â”€â”€ list_subscriptions() -> List[str]
â”‚
â”œâ”€â”€ çŠ¶æ€ç®¡ç†æ–¹æ³•
â”‚   â”œâ”€â”€ async get_connection_status() -> ConnectionStatus
â”‚   â”œâ”€â”€ async ping() -> float
â”‚   â”œâ”€â”€ get_proxy_statistics() -> ProxyStatistics
â”‚   â””â”€â”€ is_client_ready() -> bool
â”‚
â””â”€â”€ ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
    â”œâ”€â”€ async connect() -> bool
    â”œâ”€â”€ async disconnect() -> bool
    â””â”€â”€ async cleanup() -> None
```

### 5.3 LearnerStubç»Ÿä¸€å­˜æ ¹è®¾è®¡

**æ ¸å¿ƒèŒè´£**ï¼šå®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡ç«¯è¯·æ±‚ã€ç®¡ç†å®¢æˆ·ç«¯æ³¨å†Œå’Œè°ƒç”¨æœ¬åœ°BaseLearneræ‰§è¡Œ

**å…³é”®ç‰¹æ€§**ï¼š
- å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æ³¨å†Œå’Œæ³¨é”€ç®¡ç†
- æ¥æ”¶å¹¶å¤„ç†æœåŠ¡ç«¯RPCè¯·æ±‚
- è°ƒç”¨æœ¬åœ°BaseLearneræ‰§è¡Œä¸šåŠ¡é€»è¾‘
- è¯·æ±‚å‚æ•°éªŒè¯å’Œç»“æœå°è£…
- å¼‚å¸¸å¤„ç†å’Œé”™è¯¯è¿”å›
- å®¢æˆ·ç«¯ç”Ÿå‘½å‘¨æœŸç®¡ç†

**æ¥å£è§„èŒƒ**ï¼š

```
LearnerStub (ç»Ÿä¸€å­˜æ ¹ç±»)
â”œâ”€â”€ åˆå§‹åŒ–å‚æ•°
â”‚   â”œâ”€â”€ learner: BaseLearner (æœ¬åœ°å­¦ä¹ å™¨å®ä¾‹)
â”‚   â”œâ”€â”€ communication_manager: CommunicationManager (é€šä¿¡ç®¡ç†å™¨)
â”‚   â”œâ”€â”€ connection_manager: ConnectionManager (è¿æ¥ç®¡ç†å™¨)
â”‚   â””â”€â”€ config: StubConfig (å­˜æ ¹é…ç½®)
â”‚
â”œâ”€â”€ å®¢æˆ·ç«¯æ³¨å†Œæ–¹æ³• (æ¡†æ¶æä¾›)
â”‚   â”œâ”€â”€ async register_to_server() -> RegistrationResult
â”‚   â”œâ”€â”€ async unregister_from_server() -> bool
â”‚   â”œâ”€â”€ async update_registration_info(updates: Dict) -> bool
â”‚   â”œâ”€â”€ get_registration_status() -> RegistrationStatus
â”‚   â””â”€â”€ async handle_registration_failure() -> None
â”‚
â”œâ”€â”€ RPCå¤„ç†æ–¹æ³•
â”‚   â”œâ”€â”€ async handle_train_request(request: TrainRequest) -> TrainingResult
â”‚   â”œâ”€â”€ async handle_evaluate_request(request: EvaluateRequest) -> EvaluationResult
â”‚   â”œâ”€â”€ async handle_get_model_request(request: GetModelRequest) -> ModelData
â”‚   â”œâ”€â”€ async handle_set_model_request(request: SetModelRequest) -> bool
â”‚   â””â”€â”€ async handle_remote_call(request: RemoteCallRequest) -> Any
â”‚
â”œâ”€â”€ è¯·æ±‚åˆ†å‘æ–¹æ³•
â”‚   â”œâ”€â”€ async process_business_request(request: BusinessRequest) -> BusinessResponse
â”‚   â”œâ”€â”€ async route_request_to_method(method_name: str, params: Dict) -> Any
â”‚   â”œâ”€â”€ validate_request_parameters(request: Any) -> bool
â”‚   â””â”€â”€ format_response_data(result: Any) -> ResponseData
â”‚
â”œâ”€â”€ é”™è¯¯å¤„ç†æ–¹æ³•
â”‚   â”œâ”€â”€ handle_method_not_found(method_name: str) -> ErrorResponse
â”‚   â”œâ”€â”€ handle_validation_error(error: ValidationError) -> ErrorResponse
â”‚   â”œâ”€â”€ handle_execution_error(error: Exception) -> ErrorResponse
â”‚   â””â”€â”€ log_request_error(request: Any, error: Exception) -> None
â”‚
â””â”€â”€ ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
    â”œâ”€â”€ async start_listening() -> None
    â”œâ”€â”€ async stop_listening() -> None
    â””â”€â”€ async cleanup() -> None
```

**å®¢æˆ·ç«¯æ³¨å†Œæµç¨‹**ï¼š
```
1. LearnerStub.start_listening()
   â”œâ”€â”€ è°ƒç”¨ register_to_server() å‘æœåŠ¡ç«¯æ³¨å†Œ
   â”œâ”€â”€ æ³¨å†ŒæˆåŠŸåå¼€å§‹ç›‘å¬æœåŠ¡ç«¯è¯·æ±‚
   â”œâ”€â”€ å¯åŠ¨å¿ƒè·³æœºåˆ¶ç»´æŒè¿æ¥
   â””â”€â”€ æ³¨å†Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸

2. è¿è¡Œæ—¶ç»´æŠ¤
   â”œâ”€â”€ é€šè¿‡CommunicationManagerç»´æŒå¿ƒè·³
   â”œâ”€â”€ å¤„ç†æœåŠ¡ç«¯çš„è®­ç»ƒè¯·æ±‚
   â””â”€â”€ ç›‘æ§æ³¨å†ŒçŠ¶æ€

3. æ¸…ç†é€€å‡º
   â”œâ”€â”€ è°ƒç”¨ unregister_from_server() æ³¨é”€
   â”œâ”€â”€ åœæ­¢ç›‘å¬è¯·æ±‚
   â””â”€â”€ æ¸…ç†èµ„æº
```

## 6. é€šç”¨é€šä¿¡ç»„ä»¶è¯¦ç»†è®¾è®¡

### 6.1 CommunicationManageræŠ½è±¡æ¥å£è®¾è®¡

**æ ¸å¿ƒèŒè´£**ï¼šæä¾›ä¸è”é‚¦å­¦ä¹ ä¸šåŠ¡æ— å…³çš„åŸºç¡€é€šä¿¡æœåŠ¡

**å…³é”®ç‰¹æ€§**ï¼š
- å®¢æˆ·ç«¯ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å¿ƒè·³ä¿æ´»æœºåˆ¶
- çŠ¶æ€æŸ¥è¯¢å’ŒåŒæ­¥
- é€šç”¨æ¶ˆæ¯è·¯ç”±
- è¿æ¥æ± ç®¡ç†

**æ¥å£è§„èŒƒ**ï¼š

```
CommunicationManagerBase (æŠ½è±¡åŸºç±»)
â”œâ”€â”€ åˆå§‹åŒ–å‚æ•°
â”‚   â”œâ”€â”€ node_id: str (èŠ‚ç‚¹å”¯ä¸€æ ‡è¯†)
â”‚   â”œâ”€â”€ transport: TransportBase (ä¼ è¾“å±‚å®ä¾‹)
â”‚   â”œâ”€â”€ config: CommunicationConfig (é€šä¿¡é…ç½®)
â”‚   â””â”€â”€ logger: Logger (æ—¥å¿—è®°å½•å™¨)
â”‚
â”œâ”€â”€ å®¢æˆ·ç«¯ç®¡ç†æ–¹æ³• (ç”±LearnerStubè°ƒç”¨)
â”‚   â”œâ”€â”€ async register_client(client_info: ClientInfo) -> RegistrationResult
â”‚   â”œâ”€â”€ async unregister_client(client_id: str) -> bool
â”‚   â”œâ”€â”€ async update_client_info(client_id: str, updates: Dict) -> bool
â”‚   â”œâ”€â”€ async get_client_info(client_id: str) -> ClientInfo
â”‚   â””â”€â”€ async list_clients(filters: Dict = None) -> List[ClientInfo]
â”‚
â”œâ”€â”€ å¿ƒè·³ç®¡ç†æ–¹æ³•
â”‚   â”œâ”€â”€ async start_heartbeat(interval: float = 30.0) -> None
â”‚   â”œâ”€â”€ async stop_heartbeat() -> None
â”‚   â”œâ”€â”€ async send_heartbeat(target: str = None) -> bool
â”‚   â”œâ”€â”€ async check_client_alive(client_id: str) -> bool
â”‚   â””â”€â”€ get_heartbeat_status() -> HeartbeatStatus
â”‚
â”œâ”€â”€ æ¶ˆæ¯è·¯ç”±æ–¹æ³•
â”‚   â”œâ”€â”€ async send_business_message(target: str, message_type: str, data: Any) -> Any
â”‚   â”œâ”€â”€ async send_control_message(target: str, message_type: str, data: Any) -> bool
â”‚   â”œâ”€â”€ async broadcast_message(targets: List[str], message_type: str, data: Any) -> Dict[str, bool]
â”‚   â””â”€â”€ register_message_handler(message_type: str, handler: Callable) -> str
â”‚
â”œâ”€â”€ çŠ¶æ€ç®¡ç†æ–¹æ³•
â”‚   â”œâ”€â”€ async get_node_status() -> NodeStatus
â”‚   â”œâ”€â”€ async get_connection_stats() -> ConnectionStatistics
â”‚   â”œâ”€â”€ async get_system_metrics() -> SystemMetrics
â”‚   â””â”€â”€ async health_check() -> HealthStatus
â”‚
â””â”€â”€ ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
    â”œâ”€â”€ async start() -> None
    â”œâ”€â”€ async stop() -> None
    â””â”€â”€ async cleanup() -> None
```

### 6.2 ä¸‰ç§æ¨¡å¼é€šä¿¡ç®¡ç†å™¨ç‰¹ç‚¹

#### Memoryæ¨¡å¼é€šä¿¡ç®¡ç†å™¨
**å®ç°ç‰¹ç‚¹**ï¼š
- å…±äº«å†…å­˜çŠ¶æ€ç®¡ç†
- ç›´æ¥å¯¹è±¡å¼•ç”¨é€šä¿¡
- å³æ—¶çŠ¶æ€åŒæ­¥
- æ¨¡æ‹Ÿç½‘ç»œé€šä¿¡è¡Œä¸º

**æ ¸å¿ƒç»„ä»¶**ï¼š
- SharedClientRegistry - å…±äº«å®¢æˆ·ç«¯æ³¨å†Œè¡¨
- MemoryHeartbeatTracker - å†…å­˜å¿ƒè·³è·Ÿè¸ªå™¨
- MemoryMessageDispatcher - å†…å­˜æ¶ˆæ¯åˆ†å‘å™¨

#### Processæ¨¡å¼é€šä¿¡ç®¡ç†å™¨
**å®ç°ç‰¹ç‚¹**ï¼š
- è¿›ç¨‹é—´é˜Ÿåˆ—é€šä¿¡
- æ¶ˆæ¯åºåˆ—åŒ–ä¼ è¾“
- è¿›ç¨‹çŠ¶æ€ç®¡ç†
- è¿›ç¨‹æ•…éšœæ¢å¤

**æ ¸å¿ƒç»„ä»¶**ï¼š
- ControlQueueManager - æ§åˆ¶é˜Ÿåˆ—ç®¡ç†å™¨
- ProcessRegistry - è¿›ç¨‹æ³¨å†Œè¡¨
- ProcessHeartbeatService - è¿›ç¨‹å¿ƒè·³æœåŠ¡

#### Networkæ¨¡å¼é€šä¿¡ç®¡ç†å™¨
**å®ç°ç‰¹ç‚¹**ï¼š
- HTTP/WebSocketç½‘ç»œé€šä¿¡
- åˆ†å¸ƒå¼éƒ¨ç½²æ”¯æŒ
- ç½‘ç»œæ•…éšœå¤„ç†
- å®‰å…¨è®¤è¯æœºåˆ¶

**æ ¸å¿ƒç»„ä»¶**ï¼š
- NetworkHTTPServer - HTTPæœåŠ¡å™¨
- NetworkWebSocketServer - WebSocketæœåŠ¡å™¨
- NetworkConnectionPool - ç½‘ç»œè¿æ¥æ± 

## 7. è¿æ¥ç®¡ç†å±‚è¯¦ç»†è®¾è®¡

### 7.1 ConnectionManagerè®¾è®¡

**æ ¸å¿ƒèŒè´£**ï¼šç»Ÿä¸€ç®¡ç†è¿æ¥ç”Ÿå‘½å‘¨æœŸå’Œæ¶ˆæ¯è·¯ç”±

#### è¿æ¥æ± ç®¡ç† (ConnectionPool)

**è¿æ¥ç±»å‹å®šä¹‰**ï¼š
```
ConnectionæŠ½è±¡ç±»
â”œâ”€â”€ connection_id: str
â”œâ”€â”€ source_id: str
â”œâ”€â”€ target_id: str
â”œâ”€â”€ connection_type: ConnectionType (BUSINESS_RPC/BUSINESS_PUSH/CONTROL_*)
â”œâ”€â”€ status: ConnectionStatus (CONNECTING/CONNECTED/ACTIVE/IDLE/DISCONNECTED)
â”œâ”€â”€ created_time: datetime
â”œâ”€â”€ last_activity: datetime
â”œâ”€â”€ statistics: ConnectionStatistics
â””â”€â”€ metadata: Dict[str, Any]
```

**è¿æ¥ç®¡ç†ç­–ç•¥**ï¼š
- è¿æ¥å¤ç”¨æœºåˆ¶å‡å°‘å¼€é”€
- è¿æ¥æ± å®¹é‡é™åˆ¶
- è¿æ¥è¶…æ—¶è‡ªåŠ¨æ¸…ç†
- è¿æ¥å¥åº·æ£€æŸ¥
- è¿æ¥ä¼˜é›…å…³é—­

#### æ¶ˆæ¯è·¯ç”±å™¨ (MessageRouter)

**è·¯ç”±è§„åˆ™å¼•æ“**ï¼š
```
RoutingRule
â”œâ”€â”€ rule_id: str
â”œâ”€â”€ source_pattern: str
â”œâ”€â”€ target_pattern: str
â”œâ”€â”€ message_type_pattern: str
â”œâ”€â”€ priority: int
â”œâ”€â”€ conditions: List[Condition]
â”œâ”€â”€ actions: List[Action] (FORWARD/DUPLICATE/TRANSFORM/FILTER)
â”œâ”€â”€ enabled: bool
â””â”€â”€ statistics: RuleStatistics
```

### 7.2 åŒé€šé“æ¶æ„è®¾è®¡

#### ä¸šåŠ¡é€šé“ (BusinessChannel)

**æ¶ˆæ¯ç±»å‹**ï¼š
- **RPCè¯·æ±‚æ¶ˆæ¯**ï¼šè¿œç¨‹æ–¹æ³•è°ƒç”¨è¯·æ±‚
- **RPCå“åº”æ¶ˆæ¯**ï¼šè¿œç¨‹æ–¹æ³•è°ƒç”¨å“åº”
- **æ¨¡å‹æ¨é€æ¶ˆæ¯**ï¼šæ¨¡å‹æ•°æ®å¹¿æ’­
- **è®­ç»ƒäº‹ä»¶æ¶ˆæ¯**ï¼šè®­ç»ƒç›¸å…³äº‹ä»¶é€šçŸ¥

**é€šé“ç‰¹æ€§**ï¼š
- é«˜å¹¶å‘æ”¯æŒ
- æ¶ˆæ¯ä¼˜å…ˆçº§å¤„ç†
- æµé‡æ§åˆ¶æœºåˆ¶
- ä¸šåŠ¡å¼‚å¸¸å¤„ç†
- æ€§èƒ½ç›‘æ§

#### æ§åˆ¶é€šé“ (ControlChannel)

**æ¶ˆæ¯ç±»å‹**ï¼š
- **æ³¨å†Œè¯·æ±‚æ¶ˆæ¯**ï¼šå®¢æˆ·ç«¯æ³¨å†Œ/æ³¨é”€
- **å¿ƒè·³æ¶ˆæ¯**ï¼šä¿æ´»å¿ƒè·³
- **çŠ¶æ€æŸ¥è¯¢æ¶ˆæ¯**ï¼šç³»ç»ŸçŠ¶æ€æŸ¥è¯¢
- **ç®¡ç†å‘½ä»¤æ¶ˆæ¯**ï¼šç³»ç»Ÿç®¡ç†å‘½ä»¤

**é€šé“ç‰¹æ€§**ï¼š
- é«˜å¯é æ€§ä¿è¯
- ä½å»¶è¿Ÿå¤„ç†
- æ¶ˆæ¯é¡ºåºä¿è¯
- æ•…éšœéš”ç¦»æœºåˆ¶
- å®‰å…¨éªŒè¯

## 8. ä¼ è¾“æŠ½è±¡å±‚è®¾è®¡

### 8.1 ç»Ÿä¸€ä¼ è¾“æ¥å£

**TransportBaseæŠ½è±¡æ¥å£**ï¼š

```
TransportBase (æŠ½è±¡åŸºç±»)
â”œâ”€â”€ åŸºç¡€ä¼ è¾“æ–¹æ³•
â”‚   â”œâ”€â”€ async send(source: str, target: str, data: Any) -> bool
â”‚   â”œâ”€â”€ async receive(target: str, source: str, timeout: float) -> Any
â”‚   â”œâ”€â”€ async broadcast(source: str, targets: List[str], data: Any) -> Dict[str, bool]
â”‚   â””â”€â”€ async gather(target: str, sources: List[str], timeout: float) -> Dict[str, Any]
â”‚
â”œâ”€â”€ åŒå‘é€šä¿¡æ–¹æ³•
â”‚   â”œâ”€â”€ async push_event(source: str, target: str, event_type: str, data: Any) -> bool
â”‚   â”œâ”€â”€ register_event_handler(event_type: str, handler: Callable) -> str
â”‚   â”œâ”€â”€ unregister_event_handler(handler_id: str) -> bool
â”‚   â””â”€â”€ async start_event_listener(node_id: str) -> None
â”‚
â”œâ”€â”€ è¿æ¥ç®¡ç†æ–¹æ³•
â”‚   â”œâ”€â”€ async create_connection(source: str, target: str) -> Connection
â”‚   â”œâ”€â”€ async close_connection(connection_id: str) -> bool
â”‚   â”œâ”€â”€ get_connection_status(connection_id: str) -> ConnectionStatus
â”‚   â””â”€â”€ list_connections() -> List[Connection]
â”‚
â””â”€â”€ ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
    â”œâ”€â”€ async initialize() -> bool
    â”œâ”€â”€ async start() -> None
    â”œâ”€â”€ async stop() -> None
    â””â”€â”€ async cleanup() -> None
```

### 8.2 Source/Targetè·¯ç”±è§„èŒƒ

**æ ‡è¯†ç¬¦æ ¼å¼è§„èŒƒ**ï¼š

#### Memoryæ¨¡å¼æ ‡è¯†ç¬¦
```
Server IDæ ¼å¼: "memory_server"
Client IDæ ¼å¼: "memory_client_{index}"

ç¤ºä¾‹:
â”œâ”€â”€ Server: "memory_server"
â”œâ”€â”€ Client1: "memory_client_1"
â”œâ”€â”€ Client2: "memory_client_2"
â””â”€â”€ Client3: "memory_client_3"
```

#### Processæ¨¡å¼æ ‡è¯†ç¬¦
```
Server IDæ ¼å¼: "process_server_{port}"
Client IDæ ¼å¼: "process_client_{pid}_{port}"

ç¤ºä¾‹:
â”œâ”€â”€ Server: "process_server_8000"
â”œâ”€â”€ Client1: "process_client_1234_8001"
â”œâ”€â”€ Client2: "process_client_5678_8002"
â””â”€â”€ Client3: "process_client_9012_8003"
```

#### Networkæ¨¡å¼æ ‡è¯†ç¬¦
```
Server IDæ ¼å¼: "network_server_{host}_{port}"
Client IDæ ¼å¼: "network_client_{host}_{port}_{uuid}"

ç¤ºä¾‹:
â”œâ”€â”€ Server: "network_server_192.168.1.100_8000"
â”œâ”€â”€ Client1: "network_client_192.168.1.101_8001_abc123"
â”œâ”€â”€ Client2: "network_client_192.168.1.102_8002_def456"
â””â”€â”€ Client3: "network_client_192.168.1.103_8003_ghi789"
```

**è·¯ç”±éªŒè¯è§„åˆ™**ï¼š
1. æ ‡è¯†ç¬¦æ ¼å¼åˆè§„æ€§æ£€æŸ¥
2. æºç›®æ ‡ä¸èƒ½ç›¸åŒ (é˜²æ­¢è‡ªå‘è‡ªæ”¶)
3. ç›®æ ‡èŠ‚ç‚¹å­˜åœ¨æ€§éªŒè¯
4. è·¯ç”±æƒé™æ£€æŸ¥
5. è·¯ç”±ç¯è·¯æ£€æµ‹

## 9. åŒå‘é€šä¿¡æœºåˆ¶è¯¦ç»†è®¾è®¡

### 9.1 ä¸‰ç§æ¨¡å¼åŒå‘é€šä¿¡å¯¹æ¯”

| é€šä¿¡æ–¹å‘ | Memoryæ¨¡å¼ | Processæ¨¡å¼ | Networkæ¨¡å¼ |
|---------|-----------|------------|------------|
| **Server â†’ Client è°ƒç”¨** | | | |
| å®ç°æ–¹å¼ | ç›´æ¥å‡½æ•°è°ƒç”¨ | Queue + RPCè°ƒç”¨ | HTTP POSTè¯·æ±‚ |
| å®æ—¶æ€§ | å³æ—¶ (0ms) | é˜Ÿåˆ—å»¶è¿Ÿ (1-10ms) | ç½‘ç»œå»¶è¿Ÿ (10-100ms) |
| å¯é æ€§ | åŒè¿›ç¨‹å¯é  | è¿›ç¨‹é—´å¯é  | éœ€è¦é‡è¯•æœºåˆ¶ |
| **Client â†’ Server å“åº”** | | | |
| å®ç°æ–¹å¼ | ç›´æ¥è¿”å› | é˜Ÿåˆ—å“åº” | HTTPå“åº” |
| å®æ—¶æ€§ | å³æ—¶ (0ms) | é˜Ÿåˆ—å»¶è¿Ÿ (1-5ms) | ç½‘ç»œå»¶è¿Ÿ (5-50ms) |
| å¯é æ€§ | åŒè¿›ç¨‹å¯é  | è¿›ç¨‹é—´å¯é  | éœ€è¦ç¡®è®¤æœºåˆ¶ |
| **Server â†’ Client æ¨é€** | | | |
| å®ç°æ–¹å¼ | å›è°ƒå‡½æ•° | äº‹ä»¶é˜Ÿåˆ— | WebSocketæ¨é€ |
| å®æ—¶æ€§ | å³æ—¶ (0ms) | äº‹ä»¶å»¶è¿Ÿ (1-5ms) | ç½‘ç»œå»¶è¿Ÿ (5-50ms) |
| å¯é æ€§ | åŒè¿›ç¨‹å¯é  | äº‹ä»¶æœºåˆ¶å¯é  | éœ€è¦ç¡®è®¤æœºåˆ¶ |

### 9.2 äº‹ä»¶é©±åŠ¨æ¶æ„

#### åŸºæœ¬äº‹ä»¶ç±»å‹å®šä¹‰

```
åŸºæœ¬äº‹ä»¶ç±»å‹
â”œâ”€â”€ CLIENT_REGISTERED     # å®¢æˆ·ç«¯æ³¨å†ŒæˆåŠŸ
â”œâ”€â”€ CLIENT_DISCONNECTED   # å®¢æˆ·ç«¯æ–­å¼€è¿æ¥
â”œâ”€â”€ TRAINING_COMPLETE     # å®¢æˆ·ç«¯è®­ç»ƒå®Œæˆ
â”œâ”€â”€ CONNECTION_LOST       # è¿æ¥ä¸¢å¤±
â””â”€â”€ ERROR_OCCURRED        # ç³»ç»Ÿé”™è¯¯
```

**äº‹ä»¶å¤„ç†æœºåˆ¶**ï¼š
- **Memoryæ¨¡å¼**ï¼šç›´æ¥å›è°ƒå‡½æ•°è°ƒç”¨
- **Processæ¨¡å¼**ï¼šäº‹ä»¶é˜Ÿåˆ— + å›è°ƒå¤„ç†
- **Networkæ¨¡å¼**ï¼šWebSocketæ¨é€ + äº‹ä»¶å¤„ç†

## 10. å·¥å‚æ¨¡å¼å’Œç»„ä»¶åˆ›å»º

### 10.1 ComponentFactoryè®¾è®¡

**æ ¸å¿ƒèŒè´£**ï¼šæ ¹æ®é…ç½®åˆ›å»ºç›¸åº”æ¨¡å¼çš„ç»„ä»¶å®ä¾‹

```
ComponentFactory
â”œâ”€â”€ ç»„ä»¶åˆ›å»ºæ–¹æ³•
â”‚   â”œâ”€â”€ create_federation_coordinator(config) -> FederationCoordinator
â”‚   â”œâ”€â”€ create_trainer_components(config) -> TrainerComponents
â”‚   â”œâ”€â”€ create_learner_components(config) -> LearnerComponents
â”‚   â”œâ”€â”€ create_transport(config) -> TransportBase
â”‚   â”œâ”€â”€ create_communication_manager(config) -> CommunicationManager
â”‚   â””â”€â”€ create_connection_manager(config) -> ConnectionManager
â”‚
â”œâ”€â”€ æ¨¡å¼å·¥å‚æ–¹æ³•
â”‚   â”œâ”€â”€ create_memory_components(config) -> MemoryComponents
â”‚   â”œâ”€â”€ create_process_components(config) -> ProcessComponents
â”‚   â””â”€â”€ create_network_components(config) -> NetworkComponents
â”‚
â””â”€â”€ è¾…åŠ©æ–¹æ³•
    â”œâ”€â”€ validate_configuration(config) -> bool
    â”œâ”€â”€ get_available_modes() -> List[str]
    â””â”€â”€ create_default_config(mode: str) -> Config
```

### 10.2 ç»„ä»¶ç»„åˆè®¾è®¡

#### TrainerComponents
```
TrainerComponents
â”œâ”€â”€ federation_coordinator: FederationCoordinator
â”œâ”€â”€ base_trainer: BaseTrainer (ç”¨æˆ·æä¾›)
â”œâ”€â”€ learner_proxies: Dict[str, LearnerProxy]
â”œâ”€â”€ communication_manager: CommunicationManager
â””â”€â”€ connection_manager: ConnectionManager
```

#### LearnerComponents
```
LearnerComponents
â”œâ”€â”€ base_learner: BaseLearner (ç”¨æˆ·æä¾›)
â”œâ”€â”€ learner_stub: LearnerStub
â”œâ”€â”€ communication_manager: CommunicationManager
â””â”€â”€ connection_manager: ConnectionManager
```

## 11. éƒ¨ç½²å’Œè¿ç»´è®¾è®¡

### 11.1 ä¸‰ç§æ¨¡å¼éƒ¨ç½²æ¶æ„

#### Memoryæ¨¡å¼éƒ¨ç½²
```
å•æœºå•è¿›ç¨‹éƒ¨ç½²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å•ä¸€Pythonè¿›ç¨‹                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Coordinator â†’ Trainer â†’ LearnerProxy          â”‚
â”‚       â†“            â†“           â†“               â”‚
â”‚  Server     Client1    Client2    Client3      â”‚
â”‚       â†“            â†“           â†“               â”‚
â”‚           å…±äº«å†…å­˜ç©ºé—´é€šä¿¡                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹:
- ä¸€ä¸ªè¿›ç¨‹åŒ…å«åè°ƒå™¨ã€æœåŠ¡ç«¯å’Œæ‰€æœ‰å®¢æˆ·ç«¯
- å…±äº«å†…å­˜ç›´æ¥é€šä¿¡
- é€‚åˆç®—æ³•å¼€å‘å’Œå¿«é€ŸåŸå‹
- èµ„æºæ¶ˆè€—æœ€å°ï¼Œè°ƒè¯•æœ€ç®€å•
```

#### Processæ¨¡å¼éƒ¨ç½²
```
æœ¬æœºå¤šè¿›ç¨‹éƒ¨ç½²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Coordinatorâ”‚Serverè¿›ç¨‹  â”‚Client1è¿›ç¨‹â”‚Client2è¿›ç¨‹â”‚
â”‚+Serverè¿›ç¨‹â”‚           â”‚          â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Coordinatorâ”‚  Trainer  â”‚ Learner1  â”‚ Learner2  â”‚
â”‚+ Trainer  â”‚+ LProxy   â”‚+ LStub    â”‚+ LStub    â”‚
â”‚+ LProxy   â”‚           â”‚          â”‚          â”‚
â”‚     â†“     â”‚     â†“     â”‚     â†“     â”‚     â†“     â”‚
â”‚         è¿›ç¨‹é—´é˜Ÿåˆ—é€šä¿¡ç³»ç»Ÿ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹:
- åè°ƒå™¨å’ŒæœåŠ¡ç«¯å¯ä»¥åœ¨åŒä¸€è¿›ç¨‹æˆ–åˆ†ç¦»
- æ¯ä¸ªå®¢æˆ·ç«¯ç‹¬ç«‹è¿›ç¨‹
- é˜Ÿåˆ—æ¶ˆæ¯é€šä¿¡
- é€‚åˆå¹¶å‘æ€§èƒ½æµ‹è¯•
```

#### Networkæ¨¡å¼éƒ¨ç½²
```
åˆ†å¸ƒå¼ç½‘ç»œéƒ¨ç½²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Coordinatorâ”‚Serveræœºå™¨  â”‚Client1æœºå™¨â”‚Client2æœºå™¨â”‚
â”‚æœºå™¨       â”‚           â”‚          â”‚          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Coordinatorâ”‚  Trainer  â”‚ Learner1  â”‚ Learner2  â”‚
â”‚+ Trainer  â”‚+ LProxy   â”‚+ LStub    â”‚+ LStub    â”‚
â”‚+ LProxy   â”‚           â”‚          â”‚          â”‚
â”‚     â†“     â”‚     â†“     â”‚     â†“     â”‚     â†“     â”‚
â”‚       ç½‘ç»œé€šä¿¡ (HTTP/WebSocket)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹:
- æ¯ä¸ªç»„ä»¶å¯ç‹¬ç«‹éƒ¨ç½²åˆ°ä¸åŒæœºå™¨
- ç½‘ç»œåè®®é€šä¿¡
- çœŸå®çš„åˆ†å¸ƒå¼ç¯å¢ƒ
- é€‚åˆç”Ÿäº§éƒ¨ç½²
```

### 11.2 é…ç½®ç®¡ç†ç­–ç•¥

#### é…ç½®æ–‡ä»¶å±‚æ¬¡ç»“æ„
```
é…ç½®å±‚æ¬¡
â”œâ”€â”€ å…¨å±€é…ç½® (global.yaml)
â”‚   â”œâ”€â”€ ç³»ç»Ÿçº§å‚æ•°
â”‚   â”œâ”€â”€ è¶…æ—¶é…ç½®
â”‚   â””â”€â”€ æ—¥å¿—é…ç½®
â”‚
â”œâ”€â”€ æ¨¡å¼é…ç½® (memory.yaml / process.yaml / network.yaml)
â”‚   â”œâ”€â”€ ä¼ è¾“å±‚é…ç½®
â”‚   â”œâ”€â”€ é€šä¿¡é…ç½®
â”‚   â””â”€â”€ æ¨¡å¼ç‰¹å®šå‚æ•°
â”‚
â””â”€â”€ è”é‚¦é…ç½® (federation.yaml)
    â”œâ”€â”€ è®­ç»ƒå‚æ•°
    â”œâ”€â”€ å®¢æˆ·ç«¯é…ç½®
    â””â”€â”€ ç®—æ³•é…ç½®
```

## 12. ç”¨æˆ·å¼€å‘æ¨¡å¼

### 12.1 æœåŠ¡ç«¯å¼€å‘æµç¨‹

1. **ç»§æ‰¿BaseTrainer** - å®ç°å…·ä½“çš„è”é‚¦ç®—æ³•é€»è¾‘
2. **é…ç½®FederationCoordinator** - è®¾ç½®è®­ç»ƒå‚æ•°å’Œå®¢æˆ·ç«¯åˆ—è¡¨
3. **å¯åŠ¨è”é‚¦è®­ç»ƒ** - é€šè¿‡Coordinatorå¯åŠ¨è®­ç»ƒ
4. **æ¡†æ¶è‡ªåŠ¨å¤„ç†** - é€šä¿¡ã€è¿æ¥ã€å¿ƒè·³ç­‰ç”±æ¡†æ¶ç®¡ç†

### 12.2 å®¢æˆ·ç«¯å¼€å‘æµç¨‹

1. **ç»§æ‰¿BaseLearner** - å®ç°æœ¬åœ°è®­ç»ƒå’Œè¯„ä¼°é€»è¾‘  
2. **é…ç½®LearnerStub** - è®¾ç½®å®¢æˆ·ç«¯ä¿¡æ¯å’Œé€šä¿¡å‚æ•°
3. **å¯åŠ¨å®¢æˆ·ç«¯æœåŠ¡** - LearnerStubè‡ªåŠ¨å‘æœåŠ¡ç«¯æ³¨å†Œå¹¶å¼€å§‹ç›‘å¬
4. **æ¡†æ¶è‡ªåŠ¨å¤„ç†** - æ³¨å†Œã€å¿ƒè·³ã€è¯·æ±‚æ¥æ”¶ã€ç»“æœè¿”å›ç”±æ¡†æ¶ç®¡ç†

**å®¢æˆ·ç«¯æ³¨å†Œè¯¦ç»†æµç¨‹**ï¼š
```
å®¢æˆ·ç«¯å¯åŠ¨ â†’ LearnerStub.start_listening() 
    â†“
å‘æœåŠ¡ç«¯æ³¨å†Œ â†’ CommunicationManager.register_client()
    â†“
æ³¨å†ŒæˆåŠŸ â†’ å¼€å§‹ç›‘å¬æœåŠ¡ç«¯è®­ç»ƒè¯·æ±‚
    â†“  
å¯åŠ¨å¿ƒè·³ â†’ ç»´æŒä¸æœåŠ¡ç«¯çš„è¿æ¥çŠ¶æ€
    â†“
ç­‰å¾…è®­ç»ƒ â†’ å¤„ç†æœåŠ¡ç«¯çš„train/evaluateè¯·æ±‚
```

### 12.3 å®Œæ•´ç³»ç»Ÿæµç¨‹

#### é˜¶æ®µä¸€ï¼šç³»ç»Ÿå¯åŠ¨ä¸å®¢æˆ·ç«¯æ³¨å†Œæµç¨‹
```
ğŸ¯ ç³»ç»Ÿå¯åŠ¨
    â†“
ğŸ‘¤ å®¢æˆ·ç«¯å¯åŠ¨ (BaseLearner + LearnerStub)
    â†“
ğŸ”„ LearnerStub.start_listening()
    â†“ å‘æœåŠ¡ç«¯æ³¨å†Œ
âš¡ CommunicationManager.register_client(client_info)
    â†“ æ³¨å†Œè¯·æ±‚å‘é€
ğŸ”— ConnectionManager â†’ TransportBase
    â†“ è·¨æ¨¡å¼ä¼ è¾“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• åˆ°è¾¾æœåŠ¡ç«¯ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ–¥ï¸ æœåŠ¡ç«¯CommunicationManager.handle_registration()
    â†“ å¤„ç†æ³¨å†Œå¹¶è¿”å›ç¡®è®¤
ğŸ“ FederationCoordinator.wait_for_clients()
    â†“ ç­‰å¾…æ‰€æœ‰å®¢æˆ·ç«¯æ³¨å†Œå®Œæˆ
ğŸ“‹ æ‰€æœ‰å®¢æˆ·ç«¯æ³¨å†ŒæˆåŠŸï¼Œç³»ç»Ÿå°±ç»ª
```

#### é˜¶æ®µäºŒï¼šå¿ƒè·³ä¿æ´»æœºåˆ¶æµç¨‹ (å¹¶è¡Œè¿è¡Œ)
```
ğŸ’“ å®¢æˆ·ç«¯å¿ƒè·³å‘é€
    â†“ æ¯30ç§’æ‰§è¡Œä¸€æ¬¡
âš¡ CommunicationManager.send_heartbeat()
    â†“ å¿ƒè·³æ¶ˆæ¯å‘é€
ğŸ”— ConnectionManager â†’ TransportBase
    â†“ è·¨æ¨¡å¼ä¼ è¾“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• åˆ°è¾¾æœåŠ¡ç«¯ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ–¥ï¸ æœåŠ¡ç«¯CommunicationManager.handle_heartbeat()
    â†“ æ›´æ–°å®¢æˆ·ç«¯æ´»è·ƒçŠ¶æ€
ğŸ“Š æœåŠ¡ç«¯HeartbeatService.check_client_status()
    â†“ æ£€æŸ¥å®¢æˆ·ç«¯å¥åº·çŠ¶æ€
âš ï¸ è¶…æ—¶æ£€æµ‹ï¼šå¦‚æœå®¢æˆ·ç«¯å¿ƒè·³è¶…æ—¶
    â†“ è§¦å‘CLIENT_DISCONNECTEDäº‹ä»¶
ğŸ“ FederationCoordinator.handle_client_failure()
    â†“ å¤„ç†å®¢æˆ·ç«¯æ•…éšœ
```

#### é˜¶æ®µä¸‰ï¼šè”é‚¦è®­ç»ƒæ‰§è¡Œæµç¨‹
```
ğŸ¯ ç”¨æˆ·å¯åŠ¨è”é‚¦å­¦ä¹ 
    â†“
ğŸ“ FederationCoordinator.start_federation()
    â†“ åˆå§‹åŒ–è®­ç»ƒç¯å¢ƒ/é€‰æ‹©æ´»è·ƒå®¢æˆ·ç«¯
ğŸ–¥ï¸ BaseTrainer.train_round(round_num, client_ids)
    â†“ æ‰§è¡Œè”é‚¦ç®—æ³•
    â†“ self.learner_proxies[client_id].train(params)
ğŸ”„ LearnerProxy.train(training_params)
    â†“ å°è£…è¿œç¨‹è°ƒç”¨
âš¡ CommunicationManager.send_business_message()
    â†“ ä¸šåŠ¡æ¶ˆæ¯è·¯ç”±
ğŸ”— ConnectionManager.route_message()
    â†“ è¿æ¥ç®¡ç†å’Œè·¯ç”±
ğŸš€ TransportBase.send()
    â†“ è·¨æ¨¡å¼ä¼ è¾“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• åˆ°è¾¾å®¢æˆ·ç«¯ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ TransportBase.receive()
    â†“ æ¥æ”¶è®­ç»ƒè¯·æ±‚
ğŸ”— ConnectionManager.handle_message()
    â†“ æ¶ˆæ¯è·¯ç”±å¤„ç†
âš¡ CommunicationManager.process_business_message()
    â†“ ä¸šåŠ¡æ¶ˆæ¯åˆ†å‘
ğŸ”„ LearnerStub.handle_train_request()
    â†“ è°ƒç”¨æœ¬åœ°å­¦ä¹ å™¨
ğŸ‘¤ BaseLearner.train(training_params)
    â†“ æ‰§è¡Œæœ¬åœ°è®­ç»ƒ
    â†“ è§¦å‘TRAINING_COMPLETEäº‹ä»¶
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• è®­ç»ƒç»“æœè¿”å› â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ FederationCoordinatoræ”¶åˆ°æ‰€æœ‰å®¢æˆ·ç«¯ç»“æœ
    â†“ åè°ƒä¸‹ä¸€è½®è®­ç»ƒ
ğŸ–¥ï¸ BaseTrainer.aggregate_models()
    â†“ æ¨¡å‹èšåˆå’Œæ›´æ–°
ğŸ“ FederationCoordinatorç»§ç»­æˆ–ç»“æŸè®­ç»ƒ
```

#### é˜¶æ®µå››ï¼šç³»ç»Ÿå…³é—­æµç¨‹
```
ğŸ›‘ è”é‚¦è®­ç»ƒç»“æŸæˆ–ç”¨æˆ·ç»ˆæ­¢
    â†“
ğŸ“ FederationCoordinator.stop_federation()
    â†“ é€šçŸ¥æ‰€æœ‰å®¢æˆ·ç«¯åœæ­¢
ğŸ”„ LearnerStub.stop_listening()
    â†“ å‘æœåŠ¡ç«¯æ³¨é”€
âš¡ CommunicationManager.unregister_client()
    â†“ æ³¨é”€è¯·æ±‚å‘é€
ğŸ”— ConnectionManager â†’ TransportBase
    â†“ è·¨æ¨¡å¼ä¼ è¾“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• åˆ°è¾¾æœåŠ¡ç«¯ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ–¥ï¸ æœåŠ¡ç«¯å¤„ç†å®¢æˆ·ç«¯æ³¨é”€
    â†“ æ¸…ç†å®¢æˆ·ç«¯ä¿¡æ¯
ğŸ’“ åœæ­¢å¿ƒè·³æœºåˆ¶
    â†“ æ¸…ç†è¿æ¥èµ„æº
ğŸ“‹ ç³»ç»Ÿå®Œå…¨å…³é—­
```

## 13. ç»„ä»¶åˆå§‹åŒ–å’Œä¾èµ–æ³¨å…¥è®¾è®¡

### 13.1 ç»„ä»¶åˆ›å»ºé¡ºåºå’Œä¾èµ–å…³ç³»

**ç»„ä»¶åˆå§‹åŒ–é¡ºåº**ï¼š
```
ç¬¬1æ­¥ï¼šåˆ›å»ºTransportBase (æœ€åº•å±‚ï¼Œæ— ä¾èµ–)
    â”œâ”€â”€ MemoryTransport / ProcessTransport / NetworkTransport
    â”œâ”€â”€ æ ¹æ®æ¨¡å¼é…ç½®é€‰æ‹©å…·ä½“å®ç°
    â””â”€â”€ åˆå§‹åŒ–ä¼ è¾“å±‚åŸºç¡€è®¾æ–½

ç¬¬2æ­¥ï¼šåˆ›å»ºCommunicationManager (ä¾èµ–TransportBase)
    â”œâ”€â”€ MemoryManager / ProcessManager / NetworkManager
    â”œâ”€â”€ æ³¨å…¥TransportBaseå®ä¾‹
    â””â”€â”€ åˆå§‹åŒ–æ³¨å†Œã€å¿ƒè·³ã€æ¶ˆæ¯è·¯ç”±æœåŠ¡

ç¬¬3æ­¥ï¼šåˆ›å»ºConnectionManager (ä¾èµ–CommunicationManager)
    â”œâ”€â”€ æ³¨å…¥CommunicationManagerå®ä¾‹
    â”œâ”€â”€ åˆå§‹åŒ–è¿æ¥æ± å’Œæ¶ˆæ¯è·¯ç”±å™¨
    â””â”€â”€ å»ºç«‹è¿æ¥ç®¡ç†ç­–ç•¥

ç¬¬4æ­¥ï¼šåˆ›å»ºLearnerProxy/LearnerStub (ä¾èµ–å‰ä¸‰è€…)
    â”œâ”€â”€ æ³¨å…¥CommunicationManagerå’ŒConnectionManager
    â”œâ”€â”€ åˆå§‹åŒ–ä¸šåŠ¡é€šä¿¡ä»£ç†
    â””â”€â”€ å»ºç«‹è¿œç¨‹è°ƒç”¨æœºåˆ¶

ç¬¬5æ­¥ï¼šåˆ›å»ºä¸Šå±‚ä¸šåŠ¡ç»„ä»¶
    â”œâ”€â”€ FederationCoordinator (ä¾èµ–é…ç½®å’Œå·¥å‚)
    â”œâ”€â”€ BaseTrainer (ä¾èµ–LearnerProxyé›†åˆ)
    â””â”€â”€ BaseLearner (ä¾èµ–æœ¬åœ°èµ„æº)
```

**ä¾èµ–æ³¨å…¥å…³ç³»å›¾**ï¼š
```
FederationCoordinator
    â”œâ”€â”€ BaseTrainer (ç”¨æˆ·ç»§æ‰¿å®ç°)
    â”‚   â””â”€â”€ Dict[str, LearnerProxy]
    â”‚       â””â”€â”€ CommunicationManager
    â”‚           â””â”€â”€ TransportBase
    â”‚
    â”œâ”€â”€ ClientComponents (æ¯ä¸ªå®¢æˆ·ç«¯)
    â”‚   â”œâ”€â”€ BaseLearner (ç”¨æˆ·ç»§æ‰¿å®ç°)
    â”‚   â””â”€â”€ LearnerStub
    â”‚       â””â”€â”€ CommunicationManager
    â”‚           â””â”€â”€ TransportBase
    â”‚
    â””â”€â”€ ConnectionManager
        â””â”€â”€ CommunicationManager
```

### 13.2 ComponentFactoryåˆ›å»ºæµç¨‹

**ç»„ä»¶åˆ›å»ºAPI**ï¼š
```
ComponentFactory
â”œâ”€â”€ create_server_components(config) -> ServerComponents
â”‚   â”œâ”€â”€ åˆ›å»ºæœåŠ¡ç«¯TransportBase
â”‚   â”œâ”€â”€ åˆ›å»ºæœåŠ¡ç«¯CommunicationManager
â”‚   â”œâ”€â”€ åˆ›å»ºConnectionManager
â”‚   â”œâ”€â”€ åˆ›å»ºLearnerProxyé›†åˆ
â”‚   â”œâ”€â”€ åˆ›å»ºFederationCoordinator
â”‚   â””â”€â”€ è¿”å›ServerComponentså®ä¾‹
â”‚
â”œâ”€â”€ create_client_components(config) -> ClientComponents
â”‚   â”œâ”€â”€ åˆ›å»ºå®¢æˆ·ç«¯TransportBase
â”‚   â”œâ”€â”€ åˆ›å»ºå®¢æˆ·ç«¯CommunicationManager
â”‚   â”œâ”€â”€ åˆ›å»ºLearnerStub
â”‚   â””â”€â”€ è¿”å›ClientComponentså®ä¾‹
â”‚
â””â”€â”€ create_standalone_components(config) -> StandaloneComponents
    â”œâ”€â”€ åŒæ—¶åˆ›å»ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ç»„ä»¶
    â”œâ”€â”€ é€‚ç”¨äºMemoryæ¨¡å¼å•è¿›ç¨‹éƒ¨ç½²
    â””â”€â”€ è¿”å›å®Œæ•´ç»„ä»¶é›†åˆ
```

## 14. æ¶ˆæ¯åè®®å’Œæ•°æ®æ ¼å¼å®šä¹‰

### 14.1 æ ¸å¿ƒæ¶ˆæ¯ç±»å‹å®šä¹‰

```python
# å®¢æˆ·ç«¯æ³¨å†Œæ¶ˆæ¯
@dataclass
class RegistrationMessage:
    client_id: str
    client_type: str = "learner"  # learner/trainer
    capabilities: List[str] = field(default_factory=list)  # ["train", "evaluate"]
    metadata: Dict[str, Any] = field(default_factory=dict)
    timestamp: datetime = field(default_factory=datetime.now)

# æ³¨å†Œå“åº”æ¶ˆæ¯
@dataclass  
class RegistrationResponse:
    success: bool
    client_id: str
    server_info: Dict[str, Any]
    error_message: Optional[str] = None
    timestamp: datetime = field(default_factory=datetime.now)

# è®­ç»ƒè¯·æ±‚æ¶ˆæ¯
@dataclass
class TrainingRequest:
    request_id: str
    client_id: str
    method_name: str  # "train"/"evaluate"/"get_model"/"set_model"
    parameters: Dict[str, Any]
    timeout: float = 120.0
    timestamp: datetime = field(default_factory=datetime.now)

# è®­ç»ƒå“åº”æ¶ˆæ¯  
@dataclass
class TrainingResponse:
    request_id: str
    client_id: str
    success: bool
    result: Any = None
    error_message: Optional[str] = None
    execution_time: float = 0.0
    timestamp: datetime = field(default_factory=datetime.now)

# å¿ƒè·³æ¶ˆæ¯
@dataclass
class HeartbeatMessage:
    client_id: str
    status: str = "alive"  # alive/busy/idle/error
    metrics: Dict[str, Any] = field(default_factory=dict)
    timestamp: datetime = field(default_factory=datetime.now)

# äº‹ä»¶æ¶ˆæ¯
@dataclass
class EventMessage:
    event_type: str  # CLIENT_REGISTERED/CLIENT_DISCONNECTED/etc.
    source_id: str
    target_id: Optional[str] = None
    data: Any = None
    timestamp: datetime = field(default_factory=datetime.now)
```

### 14.2 æ¶ˆæ¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–

**åºåˆ—åŒ–ç­–ç•¥**ï¼š
```
Memoryæ¨¡å¼ï¼šæ— éœ€åºåˆ—åŒ–ï¼Œç›´æ¥å¯¹è±¡ä¼ é€’
Processæ¨¡å¼ï¼šä½¿ç”¨pickleåºåˆ—åŒ–ï¼Œæ”¯æŒPythonå¯¹è±¡
Networkæ¨¡å¼ï¼šä½¿ç”¨JSONåºåˆ—åŒ–ï¼Œç¡®ä¿è·¨è¯­è¨€å…¼å®¹æ€§

åºåˆ—åŒ–æ¥å£ï¼š
â”œâ”€â”€ serialize_message(message: Any) -> bytes
â”œâ”€â”€ deserialize_message(data: bytes) -> Any  
â”œâ”€â”€ validate_message_format(message: Any) -> bool
â””â”€â”€ get_message_type(message: Any) -> str
```

## 15. çŠ¶æ€ç®¡ç†å’Œäº‹ä»¶ä¼ æ’­æœºåˆ¶

### 15.1 çŠ¶æ€åŒæ­¥æœºåˆ¶

**è¿æ¥çŠ¶æ€ç®¡ç†**ï¼š
```
è¿æ¥çŠ¶æ€å˜åŒ–æµç¨‹ï¼š
TransportBaseæ£€æµ‹è¿æ¥å˜åŒ–
    â†“ è¿æ¥çŠ¶æ€äº‹ä»¶
ConnectionManager.handle_connection_event()
    â†“ æ›´æ–°è¿æ¥æ± çŠ¶æ€
    â†“ é€šçŸ¥ä¸Šå±‚ç»„ä»¶
CommunicationManager.on_connection_change()
    â†“ è§¦å‘ç›¸åº”äº‹ä»¶
EventDispatcher.dispatch_event(CONNECTION_LOST/CONNECTION_ESTABLISHED)
    â†“ é€šçŸ¥è®¢é˜…è€…
FederationCoordinator/BaseTrainerå¤„ç†è¿æ¥å˜åŒ–
```

**å®¢æˆ·ç«¯çŠ¶æ€ç®¡ç†**ï¼š
```
å®¢æˆ·ç«¯çŠ¶æ€ä¿¡æ¯ï¼š
â”œâ”€â”€ æ³¨å†ŒçŠ¶æ€ï¼šUNREGISTERED/REGISTERED/ACTIVE/INACTIVE
â”œâ”€â”€ è¿æ¥çŠ¶æ€ï¼šCONNECTED/DISCONNECTED/CONNECTING
â”œâ”€â”€ è®­ç»ƒçŠ¶æ€ï¼šIDLE/TRAINING/EVALUATING/BUSY
â”œâ”€â”€ å¥åº·çŠ¶æ€ï¼šHEALTHY/WARNING/ERROR/TIMEOUT
â””â”€â”€ æ€§èƒ½æŒ‡æ ‡ï¼šå“åº”æ—¶é—´ã€æˆåŠŸç‡ã€é”™è¯¯è®¡æ•°

çŠ¶æ€æ›´æ–°æœºåˆ¶ï¼š
â”œâ”€â”€ å®¢æˆ·ç«¯é€šè¿‡å¿ƒè·³æŠ¥å‘ŠçŠ¶æ€
â”œâ”€â”€ æœåŠ¡ç«¯é€šè¿‡RPCå“åº”æ›´æ–°çŠ¶æ€  
â”œâ”€â”€ è¶…æ—¶æ£€æµ‹è‡ªåŠ¨æ›´æ–°çŠ¶æ€
â””â”€â”€ å¼‚å¸¸äº‹ä»¶è§¦å‘çŠ¶æ€å˜æ›´
```

### 15.2 äº‹ä»¶ä¼ æ’­è·¯å¾„

```
äº‹ä»¶äº§ç”Ÿ â†’ äº‹ä»¶åˆ†å‘å™¨ â†’ äº‹ä»¶è®¢é˜…è€… â†’ å›è°ƒæ‰§è¡Œ â†’ çŠ¶æ€æ›´æ–°

å…·ä½“äº‹ä»¶ä¼ æ’­ï¼š
â”œâ”€â”€ CLIENT_REGISTERED
â”‚   â”œâ”€â”€ äº§ç”Ÿï¼šLearnerStubæ³¨å†ŒæˆåŠŸå
â”‚   â”œâ”€â”€ ä¼ æ’­ï¼šCommunicationManager â†’ FederationCoordinator
â”‚   â””â”€â”€ å¤„ç†ï¼šæ›´æ–°å¯ç”¨å®¢æˆ·ç«¯åˆ—è¡¨
â”‚
â”œâ”€â”€ CLIENT_DISCONNECTED  
â”‚   â”œâ”€â”€ äº§ç”Ÿï¼šå¿ƒè·³è¶…æ—¶æˆ–è¿æ¥å¼‚å¸¸
â”‚   â”œâ”€â”€ ä¼ æ’­ï¼šHeartbeatService â†’ FederationCoordinator
â”‚   â””â”€â”€ å¤„ç†ï¼šBaseTrainer.handle_client_failure()
â”‚
â”œâ”€â”€ TRAINING_COMPLETE
â”‚   â”œâ”€â”€ äº§ç”Ÿï¼šBaseLearner.train()æ‰§è¡Œå®Œæˆ
â”‚   â”œâ”€â”€ ä¼ æ’­ï¼šLearnerStub â†’ LearnerProxy
â”‚   â””â”€â”€ å¤„ç†ï¼šBaseTraineræ”¶é›†è®­ç»ƒç»“æœ
â”‚
â”œâ”€â”€ CONNECTION_LOST
â”‚   â”œâ”€â”€ äº§ç”Ÿï¼šTransportBaseæ£€æµ‹è¿æ¥å¤±è´¥
â”‚   â”œâ”€â”€ ä¼ æ’­ï¼šConnectionManager â†’ CommunicationManager
â”‚   â””â”€â”€ å¤„ç†ï¼šè‡ªåŠ¨é‡è¿æˆ–æ•…éšœè½¬ç§»
â”‚
â””â”€â”€ ERROR_OCCURRED
    â”œâ”€â”€ äº§ç”Ÿï¼šä»»ä½•ç»„ä»¶å¼‚å¸¸
    â”œâ”€â”€ ä¼ æ’­ï¼šå¼‚å¸¸ç»„ä»¶ â†’ é”™è¯¯å¤„ç†å™¨
    â””â”€â”€ å¤„ç†ï¼šè®°å½•æ—¥å¿—ã€æ¢å¤æˆ–ä¸ŠæŠ¥
```

## 16. é”™è¯¯å¤„ç†å’Œå¼‚å¸¸ä¼ æ’­è®¾è®¡

### 16.1 å¼‚å¸¸åˆ†ç±»å’Œå¤„ç†ç­–ç•¥

**å¼‚å¸¸ç±»å‹å®šä¹‰**ï¼š
```python
# åŸºç¡€å¼‚å¸¸ç±»
class MOEFedCLError(Exception):
    """MOE-FedCLæ¡†æ¶åŸºç¡€å¼‚å¸¸"""
    pass

# è¿æ¥å¼‚å¸¸
class ConnectionError(MOEFedCLError):
    """è¿æ¥ç›¸å…³å¼‚å¸¸"""
    pass

# æ³¨å†Œå¼‚å¸¸  
class RegistrationError(MOEFedCLError):
    """å®¢æˆ·ç«¯æ³¨å†Œå¼‚å¸¸"""
    pass

# é€šä¿¡å¼‚å¸¸
class CommunicationError(MOEFedCLError):
    """é€šä¿¡è¿‡ç¨‹å¼‚å¸¸"""
    pass

# è®­ç»ƒå¼‚å¸¸
class TrainingError(MOEFedCLError):
    """è®­ç»ƒæ‰§è¡Œå¼‚å¸¸"""
    pass

# è¶…æ—¶å¼‚å¸¸
class TimeoutError(MOEFedCLError):
    """è¶…æ—¶å¼‚å¸¸"""
    pass
```

### 16.2 å¼‚å¸¸å¤„ç†é“¾

**BaseLearnerå¼‚å¸¸å¤„ç†**ï¼š
```
BaseLearner.train()æŠ›å‡ºå¼‚å¸¸
    â†“ æ•è·å¼‚å¸¸
LearnerStub.handle_train_request()
    â†“ åŒ…è£…ä¸ºTrainingError
    â†“ æ„é€ ErrorResponse
TransportBaseè¿”å›é”™è¯¯å“åº”
    â†“ ä¼ è¾“é”™è¯¯å“åº”
LearnerProxy.train()æ¥æ”¶é”™è¯¯
    â†“ æŠ›å‡ºTrainingErrorç»™è°ƒç”¨è€…
BaseTrainer.train_round()å¤„ç†å¼‚å¸¸
    â†“ è®°å½•é”™è¯¯æ—¥å¿—
    â†“ å¯é€‰æ‹©è·³è¿‡è¯¥å®¢æˆ·ç«¯æˆ–é‡è¯•
```

**ç½‘ç»œé€šä¿¡å¼‚å¸¸å¤„ç†**ï¼š
```
TransportBase.send()ç½‘ç»œå¼‚å¸¸
    â†“ è‡ªåŠ¨é‡è¯•æœºåˆ¶(æŒ‡æ•°é€€é¿)
    â†“ é‡è¯•å¤±è´¥åæŠ›å‡ºConnectionError
ConnectionManager.route_message()æ•è·å¼‚å¸¸
    â†“ æ ‡è®°è¿æ¥ä¸ºå¼‚å¸¸çŠ¶æ€  
    â†“ è§¦å‘CONNECTION_LOSTäº‹ä»¶
CommunicationManager.on_connection_lost()
    â†“ å°è¯•é‡å»ºè¿æ¥
    â†“ é€šçŸ¥ä¸Šå±‚ç»„ä»¶è¿æ¥å¼‚å¸¸
FederationCoordinatorå¤„ç†è¿æ¥å¼‚å¸¸
    â†“ ä»å¯ç”¨å®¢æˆ·ç«¯åˆ—è¡¨ç§»é™¤
    â†“ è°ƒç”¨BaseTrainer.handle_client_failure()
```

**å¿ƒè·³è¶…æ—¶å¼‚å¸¸å¤„ç†**ï¼š
```
HeartbeatServiceæ£€æµ‹è¶…æ—¶
    â†“ è¿ç»­Næ¬¡å¿ƒè·³å¤±è´¥
    â†“ è§¦å‘CLIENT_DISCONNECTEDäº‹ä»¶
CommunicationManager.on_client_timeout()
    â†“ æ›´æ–°å®¢æˆ·ç«¯çŠ¶æ€ä¸ºTIMEOUT
    â†“ æ¸…ç†å®¢æˆ·ç«¯è¿æ¥èµ„æº
FederationCoordinator.handle_client_failure()
    â†“ ä»è®­ç»ƒåˆ—è¡¨ç§»é™¤å®¢æˆ·ç«¯
    â†“ å¯é€‰æ‹©ç­‰å¾…å®¢æˆ·ç«¯æ¢å¤æˆ–ç»§ç»­è®­ç»ƒ
```

## 17. ä¸‰ç§æ¨¡å¼å…·ä½“å®ç°å·®å¼‚

### 17.1 Memoryæ¨¡å¼ç‰¹æ®Šå®ç°

**MemoryTransportå®ç°ç‰¹ç‚¹**ï¼š
```python
class MemoryTransport(TransportBase):
    """å†…å­˜ä¼ è¾“å®ç°"""
    
    ç‰¹ç‚¹ï¼š
    â”œâ”€â”€ ç›´æ¥å‡½æ•°è°ƒç”¨ï¼Œæ— åºåˆ—åŒ–å¼€é”€
    â”œâ”€â”€ å…±äº«å†…å­˜çŠ¶æ€å­˜å‚¨(å­—å…¸/é˜Ÿåˆ—)
    â”œâ”€â”€ å³æ—¶äº‹ä»¶å›è°ƒæœºåˆ¶
    â”œâ”€â”€ é›¶ç½‘ç»œå»¶è¿Ÿ
    â””â”€â”€ åŒè¿›ç¨‹å†…å¯¹è±¡å¼•ç”¨ä¼ é€’
    
    å…³é”®æ–¹æ³•ï¼š
    â”œâ”€â”€ send(): ç›´æ¥è°ƒç”¨ç›®æ ‡å¤„ç†å‡½æ•°
    â”œâ”€â”€ receive(): ä»å…±äº«é˜Ÿåˆ—è·å–æ¶ˆæ¯
    â”œâ”€â”€ broadcast(): å¹¶å‘è°ƒç”¨å¤šä¸ªç›®æ ‡
    â””â”€â”€ push_event(): ç›´æ¥è§¦å‘å›è°ƒå‡½æ•°
```

**MemoryCommunicationManagerå®ç°**ï¼š
```python
ç‰¹ç‚¹ï¼š
â”œâ”€â”€ å®¢æˆ·ç«¯æ³¨å†Œè¡¨å­˜å‚¨åœ¨å…±äº«å­—å…¸ä¸­
â”œâ”€â”€ å¿ƒè·³æœºåˆ¶ä½¿ç”¨å®šæ—¶å™¨æ¨¡æ‹Ÿ
â”œâ”€â”€ æ¶ˆæ¯è·¯ç”±é€šè¿‡ç›´æ¥å¯¹è±¡å¼•ç”¨
â””â”€â”€ äº‹ä»¶åˆ†å‘ä½¿ç”¨åŒæ­¥å›è°ƒ

å®ç°ç»†èŠ‚ï¼š
â”œâ”€â”€ shared_registry: Dict[str, ClientInfo] = {}
â”œâ”€â”€ heartbeat_status: Dict[str, datetime] = {}
â”œâ”€â”€ message_handlers: Dict[str, Callable] = {}
â””â”€â”€ event_listeners: Dict[str, List[Callable]] = {}
```

### 17.2 Processæ¨¡å¼ç‰¹æ®Šå®ç°

**ProcessTransportå®ç°ç‰¹ç‚¹**ï¼š
```python
class ProcessTransport(TransportBase):
    """è¿›ç¨‹é—´ä¼ è¾“å®ç°"""
    
    ç‰¹ç‚¹ï¼š
    â”œâ”€â”€ ä½¿ç”¨multiprocessing.Queueè¿›è¡Œé€šä¿¡
    â”œâ”€â”€ pickleåºåˆ—åŒ–/ååºåˆ—åŒ–
    â”œâ”€â”€ è¿›ç¨‹é—´äº‹ä»¶é˜Ÿåˆ—
    â”œâ”€â”€ è¿›ç¨‹éš”ç¦»å’Œå®¹é”™
    â””â”€â”€ æ”¯æŒè¿›ç¨‹é‡å¯æ¢å¤
    
    å…³é”®ç»„ä»¶ï¼š
    â”œâ”€â”€ control_queue: æ§åˆ¶æ¶ˆæ¯é˜Ÿåˆ—
    â”œâ”€â”€ business_queue: ä¸šåŠ¡æ¶ˆæ¯é˜Ÿåˆ—  
    â”œâ”€â”€ event_queue: äº‹ä»¶æ¶ˆæ¯é˜Ÿåˆ—
    â””â”€â”€ response_queues: å“åº”é˜Ÿåˆ—é›†åˆ
```

**ProcessCommunicationManagerå®ç°**ï¼š
```python
ç‰¹ç‚¹ï¼š
â”œâ”€â”€ è·¨è¿›ç¨‹çš„å®¢æˆ·ç«¯æ³¨å†Œè¡¨
â”œâ”€â”€ åŸºäºé˜Ÿåˆ—çš„å¿ƒè·³æœºåˆ¶
â”œâ”€â”€ é˜Ÿåˆ—æ¶ˆæ¯è·¯ç”±å’Œåˆ†å‘
â””â”€â”€ è¿›ç¨‹æ•…éšœæ£€æµ‹å’Œæ¢å¤

å®ç°ç»†èŠ‚ï¼š
â”œâ”€â”€ ä½¿ç”¨Manager()åˆ›å»ºè·¨è¿›ç¨‹å…±äº«æ•°æ®ç»“æ„
â”œâ”€â”€ æ¯ä¸ªè¿›ç¨‹æœ‰ç‹¬ç«‹çš„é˜Ÿåˆ—ç›‘å¬å™¨
â”œâ”€â”€ æ”¯æŒè¿›ç¨‹é—´çš„å¼‚æ­¥æ¶ˆæ¯ä¼ é€’
â””â”€â”€ è¿›ç¨‹å´©æºƒåè‡ªåŠ¨æ¸…ç†ç›¸å…³èµ„æº
```

### 17.3 Networkæ¨¡å¼ç‰¹æ®Šå®ç°

**NetworkTransportå®ç°ç‰¹ç‚¹**ï¼š
```python
class NetworkTransport(TransportBase):
    """ç½‘ç»œä¼ è¾“å®ç°"""
    
    ç‰¹ç‚¹ï¼š
    â”œâ”€â”€ HTTPè¯·æ±‚/å“åº”æ¨¡å¼
    â”œâ”€â”€ JSONåºåˆ—åŒ–ç¡®ä¿è·¨è¯­è¨€å…¼å®¹
    â”œâ”€â”€ WebSocketé•¿è¿æ¥æ¨é€äº‹ä»¶
    â”œâ”€â”€ æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²
    â””â”€â”€ ç½‘ç»œæ•…éšœå¤„ç†å’Œé‡è¿
    
    å…³é”®ç»„ä»¶ï¼š
    â”œâ”€â”€ http_client: HTTPå®¢æˆ·ç«¯
    â”œâ”€â”€ websocket_client: WebSocketå®¢æˆ·ç«¯
    â”œâ”€â”€ connection_pool: è¿æ¥æ± ç®¡ç†
    â””â”€â”€ retry_policy: é‡è¯•ç­–ç•¥
```

**NetworkCommunicationManagerå®ç°**ï¼š
```python
ç‰¹ç‚¹ï¼š
â”œâ”€â”€ RESTful APIç«¯ç‚¹æä¾›æ³¨å†ŒæœåŠ¡
â”œâ”€â”€ åŸºäºHTTPçš„å¿ƒè·³æœºåˆ¶
â”œâ”€â”€ WebSocketå®ç°äº‹ä»¶æ¨é€
â””â”€â”€ æ”¯æŒè´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»

APIç«¯ç‚¹è®¾è®¡ï¼š
â”œâ”€â”€ POST /api/v1/register - å®¢æˆ·ç«¯æ³¨å†Œ
â”œâ”€â”€ POST /api/v1/heartbeat - å¿ƒè·³ä¸ŠæŠ¥
â”œâ”€â”€ POST /api/v1/rpc - RPCè°ƒç”¨ç«¯ç‚¹
â”œâ”€â”€ WebSocket /ws/events - äº‹ä»¶æ¨é€
â””â”€â”€ GET /api/v1/status - ç³»ç»ŸçŠ¶æ€æŸ¥è¯¢
```

## 18. å¹¶å‘å¤„ç†å’Œçº¿ç¨‹å®‰å…¨è®¾è®¡

### 18.1 å¹¶å‘å¤„ç†æœºåˆ¶

**æœåŠ¡ç«¯å¹¶å‘å¤„ç†**ï¼š
```
BaseTrainerå¹¶å‘è®­ç»ƒï¼š
â”œâ”€â”€ ä½¿ç”¨asyncio.gather()å¹¶å‘è°ƒç”¨å¤šä¸ªå®¢æˆ·ç«¯
â”œâ”€â”€ æ¯ä¸ªLearnerProxyç‹¬ç«‹å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯
â”œâ”€â”€ æ”¯æŒå®¢æˆ·ç«¯è®­ç»ƒçš„å¹¶è¡Œæ‰§è¡Œ
â””â”€â”€ å¼‚å¸¸éš”ç¦»ï¼Œå•ä¸ªå®¢æˆ·ç«¯å¤±è´¥ä¸å½±å“å…¶ä»–

ç¤ºä¾‹å¹¶å‘æ¨¡å¼ï¼š
async def train_round(self, round_num, client_ids):
    # å¹¶å‘è°ƒç”¨æ‰€æœ‰å®¢æˆ·ç«¯è®­ç»ƒ
    tasks = [
        self.learner_proxies[cid].train(params) 
        for cid in client_ids
    ]
    results = await asyncio.gather(*tasks, return_exceptions=True)
    # å¤„ç†ç»“æœå’Œå¼‚å¸¸
```

**å®¢æˆ·ç«¯å¹¶å‘å¤„ç†**ï¼š
```
LearnerStubå¹¶å‘è¯·æ±‚å¤„ç†ï¼š
â”œâ”€â”€ æ¯ä¸ªRPCè¯·æ±‚åœ¨ç‹¬ç«‹åç¨‹ä¸­å¤„ç†
â”œâ”€â”€ BaseLearneréœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨
â”œâ”€â”€ æ”¯æŒåŒæ—¶å¤„ç†å¤šä¸ªä¸åŒæ–¹æ³•è°ƒç”¨
â””â”€â”€ è¯·æ±‚é˜Ÿåˆ—é˜²æ­¢è¿‡è½½

å¹¶å‘å®‰å…¨è¦æ±‚ï¼š
â”œâ”€â”€ BaseLearner.train()éœ€è¦æ”¯æŒå¹¶å‘è°ƒç”¨
â”œâ”€â”€ æ¨¡å‹çŠ¶æ€çš„çº¿ç¨‹å®‰å…¨è®¿é—®
â”œâ”€â”€ è®­ç»ƒæ•°æ®çš„å¹¶å‘è¯»å–
â””â”€â”€ ç»“æœè¿”å›çš„å¼‚æ­¥å¤„ç†
```

### 18.2 çº¿ç¨‹å®‰å…¨è®¾è®¡

**CommunicationManagerçº¿ç¨‹å®‰å…¨**ï¼š
```python
çº¿ç¨‹å®‰å…¨ç»„ä»¶ï¼š
â”œâ”€â”€ å®¢æˆ·ç«¯æ³¨å†Œè¡¨ä½¿ç”¨è¯»å†™é”ä¿æŠ¤
â”œâ”€â”€ å¿ƒè·³çŠ¶æ€ä½¿ç”¨åŸå­æ“ä½œæ›´æ–°
â”œâ”€â”€ æ¶ˆæ¯è·¯ç”±çš„å¹¶å‘å®‰å…¨å¤„ç†
â””â”€â”€ äº‹ä»¶åˆ†å‘çš„çº¿ç¨‹å®‰å…¨

å®ç°ç­–ç•¥ï¼š
â”œâ”€â”€ ä½¿ç”¨asyncio.Lock()ä¿æŠ¤å…±äº«çŠ¶æ€
â”œâ”€â”€ åŸå­æ“ä½œæ›´æ–°è®¡æ•°å™¨å’ŒçŠ¶æ€
â”œâ”€â”€ æ— é”æ•°æ®ç»“æ„å‡å°‘ç«äº‰
â””â”€â”€ äº‹ä»¶è®¢é˜…çš„å¹¶å‘å®‰å…¨ç®¡ç†
```

**TransportBaseå¹¶å‘æ”¯æŒ**ï¼š
```
è¿æ¥æ± å¹¶å‘å®‰å…¨ï¼š
â”œâ”€â”€ è¿æ¥è·å–å’Œé‡Šæ”¾çš„åŸå­æ“ä½œ
â”œâ”€â”€ è¿æ¥çŠ¶æ€çš„å¹¶å‘æ›´æ–°
â”œâ”€â”€ æ¶ˆæ¯å‘é€çš„æ’é˜Ÿå’Œè°ƒåº¦
â””â”€â”€ è¿æ¥å¼‚å¸¸çš„å¹¶å‘å¤„ç†

äº‹ä»¶åˆ†å‘å¹¶å‘å®‰å…¨ï¼š
â”œâ”€â”€ äº‹ä»¶ç›‘å¬å™¨çš„å¹¶å‘æ³¨å†Œ/æ³¨é”€
â”œâ”€â”€ äº‹ä»¶å›è°ƒçš„å¹¶è¡Œæ‰§è¡Œ
â”œâ”€â”€ äº‹ä»¶é˜Ÿåˆ—çš„çº¿ç¨‹å®‰å…¨è®¿é—®
â””â”€â”€ å›è°ƒå¼‚å¸¸çš„éš”ç¦»å¤„ç†
```

## 19. é…ç½®ç®¡ç†å’Œä¼ é€’æœºåˆ¶

### 19.1 é…ç½®æ–‡ä»¶å±‚æ¬¡ç»“æ„

```yaml
# global.yaml - å…¨å±€åŸºç¡€é…ç½®
system:
  mode: "memory"  # memory/process/network
  log_level: "INFO"
  max_clients: 100
  
timeouts:
  registration: 60.0
  heartbeat_interval: 30.0
  heartbeat_timeout: 90.0
  rpc_timeout: 120.0
  
# memory.yaml - Memoryæ¨¡å¼ä¸“ç”¨é…ç½®  
transport:
  type: "memory"
  shared_memory_size: "1GB"
  event_queue_size: 1000
  direct_call_timeout: 30.0

communication:
  registry_type: "memory"
  heartbeat_simulation: true
  
# process.yaml - Processæ¨¡å¼ä¸“ç”¨é…ç½®
transport:
  type: "process"
  queue_backend: "multiprocessing"
  max_queue_size: 10000
  serialization: "pickle"
  process_timeout: 60.0

communication:
  registry_type: "process"
  queue_heartbeat: true
  process_recovery: true
  
# network.yaml - Networkæ¨¡å¼ä¸“ç”¨é…ç½®
transport:
  type: "network"
  protocol: "http"
  host: "0.0.0.0"
  port: 8000
  websocket_port: 8001
  ssl_enabled: false
  connection_timeout: 30.0

communication:
  registry_type: "network"  
  api_endpoints: true
  websocket_events: true
  load_balancing: false

# federation.yaml - è”é‚¦å­¦ä¹ ä¸šåŠ¡é…ç½®
federation:
  coordinator_id: "fed_coordinator"
  max_rounds: 100
  min_clients: 2
  client_selection: "all"  # all/random/custom
  
training:
  aggregation_method: "fedavg"
  convergence_threshold: 0.001
  patience: 10
```

### 19.2 é…ç½®ä¼ é€’å’Œè§£ææœºåˆ¶

**é…ç½®ä¼ é€’é“¾**ï¼š
```
é…ç½®æ–‡ä»¶åŠ è½½
    â†“ ConfigManager.load_configs()
é…ç½®åˆå¹¶å’ŒéªŒè¯
    â†“ åˆå¹¶global + mode + federationé…ç½®
    â†“ ConfigValidator.validate()
ComponentFactoryè·å–é…ç½®
    â†“ æ ¹æ®æ¨¡å¼é€‰æ‹©å¯¹åº”é…ç½®æ®µ
ç»„ä»¶ç‰¹å®šé…ç½®æå–
    â†“ TransportConfig, CommunicationConfigç­‰
ç»„ä»¶åˆå§‹åŒ–æ—¶é…ç½®æ³¨å…¥
    â†“ å„ç»„ä»¶æ ¹æ®é…ç½®åˆå§‹åŒ–è¡Œä¸º
```

**é…ç½®å¯¹è±¡å®šä¹‰**ï¼š
```python
@dataclass
class TransportConfig:
    type: str  # memory/process/network
    timeout: float
    retry_attempts: int
    specific_config: Dict[str, Any]

@dataclass  
class CommunicationConfig:
    heartbeat_interval: float
    heartbeat_timeout: float
    registration_timeout: float
    max_clients: int

@dataclass
class FederationConfig:
    coordinator_id: str
    max_rounds: int
    min_clients: int
    client_selection: str
    training_config: Dict[str, Any]
```

## 20. å®Œæ•´RPCè°ƒç”¨æ•°æ®æµ

### 20.1 è¯·æ±‚-å“åº”å®Œæ•´æ•°æ®æµ

**RPCè°ƒç”¨å®Œæ•´æµç¨‹**ï¼š
```python
# 1. æœåŠ¡ç«¯å‘èµ·è°ƒç”¨
BaseTrainer.train_round():
    result = await self.learner_proxies[client_id].train(params)

# 2. LearnerProxyå¤„ç†
LearnerProxy.train():
    request = TrainingRequest(
        request_id=generate_uuid(),
        client_id=self.client_id,
        method_name="train",
        parameters=params
    )
    response = await self.communication_manager.send_business_message(
        target=self.client_id,
        message_type="rpc_request", 
        data=request
    )

# 3. CommunicationManagerè·¯ç”±
CommunicationManager.send_business_message():
    # åºåˆ—åŒ–è¯·æ±‚
    serialized_request = self.serializer.serialize(data)
    # è·¯ç”±åˆ°ç›®æ ‡
    return await self.connection_manager.route_message(
        target, message_type, serialized_request
    )

# 4. ConnectionManagerå¤„ç†
ConnectionManager.route_message():
    connection = self.pool.get_connection(target)
    return await self.transport.send(
        source=self.node_id, 
        target=target, 
        data=serialized_request
    )

# 5. TransportBaseå‘é€
TransportBase.send():
    # æ ¹æ®æ¨¡å¼å®ç°å…·ä½“å‘é€é€»è¾‘
    # Memory: ç›´æ¥è°ƒç”¨ç›®æ ‡å¤„ç†å‡½æ•°
    # Process: æ”¾å…¥ç›®æ ‡è¿›ç¨‹é˜Ÿåˆ—
    # Network: å‘é€HTTPè¯·æ±‚

# 6. å®¢æˆ·ç«¯æ¥æ”¶å¤„ç†
TransportBase.receive():
    # æ¥æ”¶æ¶ˆæ¯å¹¶ååºåˆ—åŒ–
    request = self.serializer.deserialize(received_data)

# 7. CommunicationManageråˆ†å‘
CommunicationManager.process_business_message():
    # è·¯ç”±åˆ°å¯¹åº”çš„å¤„ç†å™¨
    return await self.learner_stub.handle_train_request(request)

# 8. LearnerStubå¤„ç†
LearnerStub.handle_train_request():
    # å‚æ•°éªŒè¯
    if not self.validate_request_parameters(request):
        return ErrorResponse("Invalid parameters")
    
    # è°ƒç”¨æœ¬åœ°å­¦ä¹ å™¨
    try:
        result = await self.learner.train(request.parameters)
        return TrainingResponse(
            request_id=request.request_id,
            success=True,
            result=result
        )
    except Exception as e:
        return TrainingResponse(
            request_id=request.request_id,
            success=False,
            error_message=str(e)
        )

# 9. å“åº”è¿”å› (åŸè·¯å¾„è¿”å›)
# TrainingResponse â†’ TransportBase â†’ ConnectionManager â†’ 
# CommunicationManager â†’ LearnerProxy â†’ BaseTrainer
```

### 20.2 ä¸åŒæ¨¡å¼çš„æ•°æ®æµå·®å¼‚

**Memoryæ¨¡å¼æ•°æ®æµ**ï¼š
```
BaseTrainer â†’ LearnerProxy â†’ MemoryCommunicationManager
    â†“ ç›´æ¥å‡½æ•°è°ƒç”¨(æ— åºåˆ—åŒ–)
MemoryTransport.send() â†’ ç›´æ¥è°ƒç”¨ç›®æ ‡å‡½æ•°
    â†“ å³æ—¶è°ƒç”¨
LearnerStub.handle_train_request() â†’ BaseLearner.train()
    â†“ åŒæ­¥æ‰§è¡Œ
ç»“æœç›´æ¥è¿”å› â†’ BaseTrainer.train_round()
```

**Processæ¨¡å¼æ•°æ®æµ**ï¼š
```
BaseTrainer â†’ LearnerProxy â†’ ProcessCommunicationManager
    â†“ pickleåºåˆ—åŒ–
ProcessTransport.send() â†’ æ¶ˆæ¯æ”¾å…¥ç›®æ ‡è¿›ç¨‹é˜Ÿåˆ—
    â†“ è·¨è¿›ç¨‹ä¼ è¾“
ç›®æ ‡è¿›ç¨‹ç›‘å¬å™¨æ¥æ”¶ â†’ ååºåˆ—åŒ– â†’ LearnerStub
    â†“ å¼‚æ­¥å¤„ç†
BaseLearner.train() â†’ ç»“æœåºåˆ—åŒ– â†’ å“åº”é˜Ÿåˆ—
    â†“ è·¨è¿›ç¨‹è¿”å›
ç»“æœååºåˆ—åŒ– â†’ BaseTrainer.train_round()
```

**Networkæ¨¡å¼æ•°æ®æµ**ï¼š
```
BaseTrainer â†’ LearnerProxy â†’ NetworkCommunicationManager
    â†“ JSONåºåˆ—åŒ–
NetworkTransport.send() â†’ HTTP POSTè¯·æ±‚
    â†“ ç½‘ç»œä¼ è¾“
å®¢æˆ·ç«¯HTTPæœåŠ¡å™¨æ¥æ”¶ â†’ JSONååºåˆ—åŒ–
    â†“ APIè·¯ç”±åˆ†å‘
LearnerStub.handle_train_request() â†’ BaseLearner.train()
    â†“ HTTPå“åº”
ç»“æœJSONåºåˆ—åŒ– â†’ HTTPå“åº”ä½“
    â†“ ç½‘ç»œè¿”å›
å“åº”ååºåˆ—åŒ– â†’ BaseTrainer.train_round()
```

## 21. æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“

### 21.1 æ¶æ„ä¼˜åŠ¿

1. **ğŸ¯ ç»Ÿä¸€å…¥å£è®¾è®¡** - FederationCoordinatorä½œä¸ºå”¯ä¸€å…¥å£ï¼Œç®€åŒ–ç”¨æˆ·ä½¿ç”¨
2. **ğŸ”§ å®Œå…¨æŠ½è±¡åˆ†ç¦»** - ç”¨æˆ·åªéœ€å…³æ³¨ç®—æ³•é€»è¾‘ï¼Œé€šä¿¡å®Œå…¨é€æ˜
3. **ğŸ“ˆ æ¨¡å¼æ— ç¼åˆ‡æ¢** - åŒä¸€å¥—ä»£ç æ”¯æŒä¸‰ç§è¿è¡Œæ¨¡å¼
4. **ğŸ”„ çœŸå®åŒå‘é€šä¿¡** - æ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨è°ƒç”¨å®¢æˆ·ç«¯å¹¶è·å–ç»“æœ
5. **âš¡ é«˜æ€§èƒ½è®¾è®¡** - åˆ†å±‚ä¼˜åŒ–ï¼Œè¿æ¥æ± ï¼Œäº‹ä»¶é©±åŠ¨
6. **ğŸ›¡ï¸ æ•…éšœå®¹é”™æœºåˆ¶** - å¿ƒè·³æ£€æµ‹ã€è‡ªåŠ¨é‡è¿ã€ä¼˜é›…é™çº§
7. **ğŸ“¦ æœ€å°æ ¸å¿ƒå®ç°** - ä¸“æ³¨é€šä¿¡åŸºç¡€è®¾æ–½ï¼Œä¸æ¶‰åŠå…·ä½“ç®—æ³•

### 21.2 ç”¨æˆ·ä½“éªŒ

- **ç®€å•æ˜“ç”¨**ï¼šç”¨æˆ·åªéœ€ç»§æ‰¿BaseTrainerå’ŒBaseLearner
- **æ¨¡å¼é€æ˜**ï¼šåˆ‡æ¢è¿è¡Œæ¨¡å¼åªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶
- **è°ƒè¯•å‹å¥½**ï¼šMemoryæ¨¡å¼æ”¯æŒæ–­ç‚¹è°ƒè¯•
- **ç”Ÿäº§å°±ç»ª**ï¼šNetworkæ¨¡å¼æ”¯æŒçœŸå®åˆ†å¸ƒå¼éƒ¨ç½²
- **æ€§èƒ½å¯æ§**ï¼šä»å•æœºæµ‹è¯•åˆ°åˆ†å¸ƒå¼ç”Ÿäº§çš„å¹³æ»‘è¿‡æ¸¡

è¿™ä¸ªé€šä¿¡æ¡†æ¶ä¸ºè”é‚¦å­¦ä¹ æä¾›äº†å®Œæ•´çš„åŸºç¡€è®¾æ–½æ”¯æŒï¼Œè®©ç ”ç©¶è€…å’Œå¼€å‘è€…èƒ½å¤Ÿä¸“æ³¨äºç®—æ³•åˆ›æ–°ï¼Œè€Œæ— éœ€å…³å¿ƒå¤æ‚çš„åˆ†å¸ƒå¼é€šä¿¡å®ç°ç»†èŠ‚ã€‚