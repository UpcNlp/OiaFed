# è”é‚¦æŒç»­å­¦ä¹ é¡¹ç›®æ—¥å¿—ç³»ç»Ÿæ”¹è¿›æ€»ç»“

## æ¦‚è¿°

æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘å·²ç»æˆåŠŸæ”¹è¿›äº† FedCL é¡¹ç›®çš„æ—¥å¿—ç³»ç»Ÿã€‚æœ¬æ¬¡æ”¹è¿›è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š

1. âœ… ä½¿ç”¨ loguru çš„ `logger.info` å’Œ `logger.debug`
2. âœ… è§£å†³ `federated_training.log` ä¸­å®¢æˆ·ç«¯æ—¥å¿—æ··ä¹±çš„é—®é¢˜
3. âœ… è®­ç»ƒç›¸å…³çš„æ—¥å¿—ä½¿ç”¨ `info` çº§åˆ«ï¼Œå…¶ä»–æ—¥å¿—ä½¿ç”¨ `debug` çº§åˆ«
4. âœ… **æ–°éœ€æ±‚**ï¼šæ‰€æœ‰æ—¥å¿—ä¿¡æ¯ä½¿ç”¨ä¸­æ–‡

## ä¸»è¦æ”¹è¿›å†…å®¹

### 1. åˆ›å»ºäº†æ”¹è¿›çš„æ—¥å¿—ç®¡ç†å™¨

**æ–‡ä»¶**: `fedcl/utils/improved_logging_manager.py`

**ä¸»è¦ç‰¹æ€§**:
- ğŸ”§ **æ—¥å¿—åˆ†ç¦»**: å®¢æˆ·ç«¯æ—¥å¿—ä¸å†æ··åˆåˆ°å…¨å±€æ—¥å¿—æ–‡ä»¶ä¸­
- ğŸ‡¨ğŸ‡³ **ä¸­æ–‡æ”¯æŒ**: æ‰€æœ‰æ—¥å¿—ä¿¡æ¯å’Œç»„ä»¶æ ‡è¯†éƒ½ä½¿ç”¨ä¸­æ–‡
- ğŸ“Š **çº§åˆ«åŒºåˆ†**: è®­ç»ƒç›¸å…³ä½¿ç”¨ `info`ï¼Œç³»ç»Ÿç›¸å…³ä½¿ç”¨ `debug`
- ğŸ“ **ç‹¬ç«‹æ–‡ä»¶**: æ¯ä¸ªå®¢æˆ·ç«¯ã€æœåŠ¡å™¨éƒ½æœ‰ç‹¬ç«‹çš„æ—¥å¿—æ–‡ä»¶

### 2. æ—¥å¿—æ–‡ä»¶ç»“æ„

```
logs/experiment_YYYYMMDD_HHMMSS/
â”œâ”€â”€ federated_training.log          # ğŸš« ä¸å†åŒ…å«å®¢æˆ·ç«¯æ—¥å¿—ï¼Œåªæœ‰æœåŠ¡å™¨å’Œç³»ç»Ÿçº§æ—¥å¿—
â”œâ”€â”€ server_main_server.log          # æœåŠ¡å™¨ä¸“ç”¨æ—¥å¿—
â””â”€â”€ clients/                        # å®¢æˆ·ç«¯æ—¥å¿—ç›®å½•
    â”œâ”€â”€ client_001.log              # å®¢æˆ·ç«¯1ç‹¬ç«‹æ—¥å¿—
    â”œâ”€â”€ client_002.log              # å®¢æˆ·ç«¯2ç‹¬ç«‹æ—¥å¿—
    â””â”€â”€ client_003.log              # å®¢æˆ·ç«¯3ç‹¬ç«‹æ—¥å¿—
```

### 3. ä¸­æ–‡æ—¥å¿—ç¤ºä¾‹

**æœåŠ¡å™¨æ—¥å¿—**:
```log
2025-08-04 14:04:48.311 | INFO | æœåŠ¡å™¨[main_server] | æœåŠ¡å™¨åˆå§‹åŒ–å¼€å§‹
2025-08-04 14:04:48.312 | INFO | æœåŠ¡å™¨[main_server] | å¼€å§‹ç¬¬ 1 è½®è”é‚¦è®­ç»ƒ
2025-08-04 14:04:48.414 | INFO | æœåŠ¡å™¨[main_server] | ç¬¬ 1 è½®è®­ç»ƒå®Œæˆï¼ŒæˆåŠŸç‡: 95%
```

**å®¢æˆ·ç«¯æ—¥å¿—**:
```log
2025-08-04 14:04:48.630 | INFO | å®¢æˆ·ç«¯[client_001] | å®¢æˆ·ç«¯ client_001 åˆå§‹åŒ–å®Œæˆ
2025-08-04 14:04:48.630 | INFO | å®¢æˆ·ç«¯[client_001] | æœ¬åœ°è®­ç»ƒ - Epoch 1
2025-08-04 14:04:48.630 | INFO | å®¢æˆ·ç«¯[client_001] | å®¢æˆ·ç«¯è®­ç»ƒå®Œæˆï¼Œä¸Šä¼ æ¨¡å‹æ›´æ–°
```

### 4. æ›´æ–°çš„é¡¹ç›®æ–‡ä»¶

é€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬æ›´æ–°äº† **70ä¸ªæ–‡ä»¶**ï¼ŒåŒ…æ‹¬ï¼š

- `fedcl/experiment/experiment.py` - å®éªŒç®¡ç†å™¨é›†æˆæ”¹è¿›æ—¥å¿—
- `fedcl/federation/coordinators/` - è”é‚¦åè°ƒå™¨
- `fedcl/engine/` - è®­ç»ƒå¼•æ“
- `fedcl/implementations/` - å„ç§å®ç°
- ä»¥åŠå…¶ä»–æ ¸å¿ƒç»„ä»¶

### 5. ä¾¿åˆ©å‡½æ•°

æä¾›äº†ç®€åŒ–çš„æ—¥å¿—è®°å½•å‡½æ•°ï¼š

```python
from fedcl.utils.improved_logging_manager import log_training_info, log_system_debug

# è®­ç»ƒç›¸å…³ - ä½¿ç”¨ info çº§åˆ«
log_training_info("å¼€å§‹è”é‚¦å­¦ä¹ å®éªŒ")
log_training_info("ç¬¬1è½®è®­ç»ƒå¼€å§‹")
log_training_info("æ¨¡å‹èšåˆå®Œæˆ")

# ç³»ç»Ÿç›¸å…³ - ä½¿ç”¨ debug çº§åˆ«  
log_system_debug("æ£€æŸ¥ç³»ç»Ÿå†…å­˜çŠ¶æ€")
log_system_debug("æ¸…ç†ä¸´æ—¶æ–‡ä»¶")
log_system_debug("é‡Šæ”¾ç½‘ç»œèµ„æº")
```

## éªŒè¯ç»“æœ

é€šè¿‡æµ‹è¯•è„šæœ¬ `simple_test_logging.py` éªŒè¯äº†æ”¹è¿›æ•ˆæœï¼š

### âœ… éªŒè¯é€šè¿‡çš„åŠŸèƒ½

1. **æ—¥å¿—åˆ†ç¦»**: `federated_training.log` ä¸å†åŒ…å«å®¢æˆ·ç«¯æ—¥å¿—
2. **ç‹¬ç«‹æ–‡ä»¶**: æ¯ä¸ªå®¢æˆ·ç«¯éƒ½æœ‰ç‹¬ç«‹çš„æ—¥å¿—æ–‡ä»¶
3. **ä¸­æ–‡æ”¯æŒ**: æ‰€æœ‰æ—¥å¿—ä¿¡æ¯éƒ½ä½¿ç”¨ä¸­æ–‡
4. **çº§åˆ«åŒºåˆ†**: è®­ç»ƒæ—¥å¿—ä½¿ç”¨ INFOï¼Œç³»ç»Ÿæ—¥å¿—ä½¿ç”¨ DEBUG
5. **æ ¼å¼ç»Ÿä¸€**: åŒ…å«æ—¶é—´æˆ³ã€çº§åˆ«ã€ç»„ä»¶æ ‡è¯†

### ğŸ“Š ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶ç¤ºä¾‹

```
ğŸ“Š ç”Ÿæˆçš„æ—¥å¿—æ–‡ä»¶:
  global: test_logs/æ—¥å¿—ç³»ç»Ÿæµ‹è¯•/federated_training.log (2017 bytes)
  server_main_server: test_logs/æ—¥å¿—ç³»ç»Ÿæµ‹è¯•/server_main_server.log (1431 bytes)
  client_client_001: test_logs/æ—¥å¿—ç³»ç»Ÿæµ‹è¯•/clients/client_001.log (1166 bytes)
  client_client_002: test_logs/æ—¥å¿—ç³»ç»Ÿæµ‹è¯•/clients/client_002.log (1166 bytes)
  client_client_003: test_logs/æ—¥å¿—ç³»ç»Ÿæµ‹è¯•/clients/client_003.log (1166 bytes)
```

## ä½¿ç”¨æ–¹å¼

### 1. åœ¨å®éªŒä¸­ä½¿ç”¨

```python
from fedcl.experiment.experiment import FedCLExperiment

# å®éªŒç®¡ç†å™¨ä¼šè‡ªåŠ¨åˆå§‹åŒ–æ”¹è¿›çš„æ—¥å¿—ç³»ç»Ÿ
experiment = FedCLExperiment(config="path/to/config.yaml")
experiment.run()
```

### 2. æ‰‹åŠ¨åˆå§‹åŒ–

```python
from fedcl.utils.improved_logging_manager import initialize_improved_logging

log_manager = initialize_improved_logging(
    log_base_dir="./logs",
    experiment_name="æˆ‘çš„å®éªŒ",
    enable_console=True,
    global_log_level="INFO"
)
```

### 3. è·å–ç»„ä»¶æ—¥å¿—å™¨

```python
from fedcl.utils.improved_logging_manager import get_component_logger

# æœåŠ¡å™¨æ—¥å¿—
server_logger = get_component_logger("server", "main_server")
server_logger.info("æœåŠ¡å™¨å¯åŠ¨å®Œæˆ")

# å®¢æˆ·ç«¯æ—¥å¿—ï¼ˆç‹¬ç«‹æ–‡ä»¶ï¼‰
client_logger = get_component_logger("client", "client_001")
client_logger.info("å¼€å§‹æœ¬åœ°è®­ç»ƒ")
```

## å¯¹æ¯”ï¼šæ”¹è¿›å‰ vs æ”¹è¿›å

### æ”¹è¿›å‰çš„é—®é¢˜
- âŒ `federated_training.log` åŒ…å«æ‰€æœ‰ç»„ä»¶æ—¥å¿—ï¼Œéå¸¸æ··ä¹±
- âŒ è‹±æ–‡æ—¥å¿—ä¿¡æ¯
- âŒ æ—¥å¿—çº§åˆ«ä½¿ç”¨ä¸å½“
- âŒ æ— æ³•åŒºåˆ†ä¸åŒå®¢æˆ·ç«¯çš„æ—¥å¿—

### æ”¹è¿›åçš„ä¼˜åŠ¿
- âœ… æ¸…æ™°çš„æ—¥å¿—æ–‡ä»¶åˆ†ç¦»
- âœ… ä¸­æ–‡æ—¥å¿—ä¿¡æ¯ï¼Œä¾¿äºç†è§£
- âœ… æ­£ç¡®çš„æ—¥å¿—çº§åˆ«ä½¿ç”¨
- âœ… æ¯ä¸ªç»„ä»¶ç‹¬ç«‹çš„æ—¥å¿—æ–‡ä»¶
- âœ… æ”¹è¿›çš„æ—¥å¿—æ ¼å¼å’Œç»„ä»¶æ ‡è¯†

## å»ºè®®

1. **æ—¥å¿—çº§åˆ«**: å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ `INFO` çº§åˆ«ï¼Œå¼€å‘è°ƒè¯•æ—¶ä½¿ç”¨ `DEBUG` çº§åˆ«
2. **ç›‘æ§**: å¯ä»¥é€šè¿‡ç›‘æ§ `federated_training.log` æ¥è·Ÿè¸ªæ•´ä½“è®­ç»ƒè¿›åº¦
3. **è°ƒè¯•**: å®¢æˆ·ç«¯é—®é¢˜å¯ä»¥ç›´æ¥æŸ¥çœ‹å¯¹åº”çš„å®¢æˆ·ç«¯æ—¥å¿—æ–‡ä»¶
4. **å­˜å‚¨**: æ—¥å¿—æ–‡ä»¶ä¼šè‡ªåŠ¨è½®è½¬å’Œå‹ç¼©ï¼Œé¿å…æ–‡ä»¶è¿‡å¤§

## æ€»ç»“

æœ¬æ¬¡æ”¹è¿›æˆåŠŸè§£å†³äº†åŸæœ‰æ—¥å¿—ç³»ç»Ÿçš„æ‰€æœ‰é—®é¢˜ï¼Œæä¾›äº†ï¼š
- ğŸ—ï¸ æ¸…æ™°çš„æ—¥å¿—æ¶æ„
- ğŸ‡¨ğŸ‡³ ä¸­æ–‡æ—¥å¿—æ”¯æŒ  
- ğŸ“Š åˆç†çš„æ—¥å¿—åˆ†çº§
- ğŸ”§ æ˜“äºä½¿ç”¨çš„API
- ğŸ“ è‰¯å¥½çš„æ–‡ä»¶ç»„ç»‡

æ”¹è¿›åçš„æ—¥å¿—ç³»ç»Ÿå°†å¤§å¤§æå‡é¡¹ç›®çš„å¯ç»´æŠ¤æ€§å’Œè°ƒè¯•æ•ˆç‡ï¼
