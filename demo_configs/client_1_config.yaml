# ====================================
# FedCL 客户端1配置 - MNIST联邦学习演示
# ====================================

# 客户端基本信息
client:
  id: "mnist_client_1"                    # 客户端唯一标识
  name: "MNIST Client 1"                  # 客户端名称
  type: "single_learner"                  # 客户端类型
  version: "1.0"                          # 配置版本

# 通信配置（伪联邦模式 - 与服务端相同端口）
communication:
  host: "localhost"                       # 客户端主机地址
  port: 8080                             # 客户端端口（与服务端相同，启用伪联邦模式）
  max_workers: 3                         # 最大并发工作线程数
  timeout: 300.0                         # 通信超时时间（秒）- 增加超时时间
  retry_attempts: 3                      # 连接重试次数
  retry_delay: 5.0                       # 重试延迟（秒）
  heartbeat_interval: 30                 # 心跳间隔（秒）
  
  # 服务端配置（连接目标）
  server:
    host: "localhost"                     # 服务端主机地址
    port: 8080                           # 服务端端口

# 学习器配置
learners:
  default_learner:
    class: "default"                      # 学习器类别
    enabled: true                         # 是否启用此learner
    scheduler: null                       # 不使用调度器，避免自动生成scheduler_id
    
    # 模型配置
    model:
      type: "mnist_cnn"                   # 使用CNN模型进行MNIST识别
      input_shape: [1, 28, 28]            # 输入形状 (channels, height, width)
      num_classes: 10                     # MNIST 10个类别 (0-9)
      dropout_rate: 0.2                   # Dropout率
      activation: "relu"                  # 激活函数
      use_batch_norm: false               # 是否使用批归一化
    
    # 优化器配置
    optimizer:
      type: "SGD"                         # 优化器类型
      lr: 0.01                           # 学习率
      momentum: 0.9                       # 动量
      weight_decay: 1e-4                  # 权重衰减
      
    # 损失函数配置
    loss_function:
      type: "CrossEntropyLoss"            # 损失函数类型
      
    # 训练配置
    training:
      local_epochs: 1                     # 本地训练轮次（减少训练时间）

# 数据集配置（顶级配置）
dataset:
  name: "MNIST"                           # 数据集名称
  path: "data/MNIST"                      # 数据集路径
  split: "train"                          # 使用训练集
  download: true                          # 是否自动下载

# 数据加载器配置
dataloaders:
  default:
    type: "StandardDataLoader"            # 使用标准数据加载器（支持MNIST）
    dataset_config:                       # 数据集配置（注意这里是dataset_config）
      name: "MNIST"                       # 数据集名称
      path: "data/MNIST"                  # 数据集路径
      split: "train"                      # 使用训练集
      download: true                      # 是否自动下载
      
    # 客户端数据分割配置
    federated_config:
      client_id: 1                        # 客户端ID
      num_clients: 3                      # 总客户端数
      distribution: "iid"                 # 数据分布：独立同分布
      samples_per_client: 2000            # 每个客户端样本数（增加样本数）
    
    # 数据加载器参数
    loader_params:
      batch_size: 32                      # 批大小（实际生效的参数）
      shuffle: true                       # 是否打乱数据
      num_workers: 0                      # 数据加载工作进程数
      drop_last: false                    # 是否丢弃最后一个不完整的批次

# Hook配置
hooks:
  enabled: true                           # 是否启用Hook系统
  
  # 检查点Hook配置 - 自动保存客户端模型和训练状态
  checkpoint:
    enabled: true                         # 启用检查点Hook
    save_frequency: 1                     # 保存频率（每1轮保存一次）
    save_model: true                      # 保存模型参数
    save_optimizer: true                  # 保存优化器状态
    save_scheduler: false                 # 不保存学习率调度器状态
    save_experiment_state: true           # 保存实验状态
    # checkpoint_dir: ""                  # 留空以使用实验级别目录
    naming_pattern: "client1_checkpoint_{phase}_round_{round}_epoch_{epoch}" # 文件命名模式（已去掉时间戳）
    max_checkpoints: 3                    # 最大保留检查点数量（客户端保留较少）
    keep_best_only: false                 # 保留所有检查点（用于演示）
    best_metric: "loss"                   # 最佳模型评判指标（客户端关注损失）
    best_mode: "min"                      # 最佳模式：损失越低越好
    compress: false                       # 不压缩检查点文件
    
  checkpoint_hook:
    enabled: true                         # 启用检查点Hook
    phase: "after_epoch"                  # 执行阶段：每个epoch结束后保存
    priority: 0                           # 优先级（数字越小优先级越高）
  
  local_training_hook:
  
  local_training_hook:
    enabled: true
    priority: 10
    config:
      log_training_progress: true
      
  evaluation_hook:
    enabled: true
    priority: 5

# 系统配置
system:
  device: "cpu"                           # 计算设备
  random_seed: 42                         # 随机种子
  num_threads: 2                          # CPU线程数

# 日志配置
logging:
  level: "DEBUG"                          # 日志级别
  save_logs: true                         # 是否保存日志
  log_frequency: 10                       # 日志频率
  log_dir: "logs/mnist_client_1"          # 日志目录
  
  formatters:
    default: "[%(asctime)s][CLIENT-1][%(name)s][%(levelname)s] %(message)s"

# 实验配置
experiment:
  name: "mnist_client_1_experiment"       # 实验名称
  description: "MNIST客户端1联邦学习实验"
  output_dir: "experiments/mnist_client_1" # 输出目录
