# MNIST 本地并行实验 - 基础配置
# 所有节点共享的配置

# 全局配置
global:
  exp_name: quick_test_label_skew  # 实验名称
  run_name:  # 运行名称（留空则自动生成时间戳）
  log_dir: ./logs  # 日志根目录

# 传输配置 - gRPC 模式（本地并行）
transport:
  mode: grpc
  grpc:
    max_workers: 10
    max_message_length: 104857600  # 100MB

    # 双线程配置（默认启用）
    dual_thread:
      enabled: true  # 启用双线程优化，心跳独立运行

    # 心跳配置（gRPC 专属，由控制线程处理）
    heartbeat:
      enabled: true
      interval: 5.0           # 心跳间隔（秒）
      timeout: 30.0           # 超时时间（秒）
      check_interval: 10.0    # 健康检查间隔（秒）

# 序列化配置 - 使用 pickle 以支持复杂对象
serialization:
  default: pickle

# 日志配置（使用新的 LogConfig 格式）
logging:
  level: DEBUG             # 文件日志级别：DEBUG / INFO / WARNING / ERROR
  console: true            # 是否输出到控制台
  console_level: DEBUG     # 控制台日志级别
  diagnose: false          # 是否开启诊断模式（详细堆栈）
  rotation: "10 MB"        # 日志轮转大小
  retention: "30 days"     # 日志保留时间
  compression: "zip"       # 压缩格式

# Tracker 配置
tracker:
  enabled: true
  tracking_dir: tracking

  backends:
    - type: mlflow
      args:
        tracking_uri: http://172.19.138.200:5000
        experiment_name: FedLearn_Test
        username: dongshou
        password: admin123admin

# Callbacks 配置
callbacks:
  - type: logging
    args:
      log_epoch: true
      log_round: true
      log_fit: false

  # MLflow Callback - 记录训练指标到MLflow
  - type: mlflow
    args:
      log_epoch: true   # 记录每个epoch的指标
      log_round: true   # 记录每个round的指标

  # Tracker Sync Callback - 同步 run_id 到所有节点
  - type: tracker_sync
    args: {}

# 超时配置
default_timeout: 60.0
