# CL Test - TARGET - Server Config
# configs/cl_test/target/server.yaml

extends: "../../distributed/base/server_base.yaml"

node_id: "cl_target_server"

logging:
  console_enabled: true
  level: "INFO"

training:
  max_rounds: 6  # 2任务 × 3轮/任务
  min_clients: 3

  trainer:
    name: "TARGET"
    params:
      local_epochs: 1
      learning_rate: 0.01
      batch_size: 64
      momentum: 0.9
      early_stopping: false  # 持续学习不使用早停

      # CL特定参数
      num_tasks: 2
      rounds_per_task: 3
      evaluate_all_tasks: true
      compute_forgetting: true

      # TARGET数据生成配置
      enable_data_generation: true
      save_dir: "run/target_synthetic_data"
      data_generation:
        synthesis_batch_size: 128
        sample_batch_size: 128
        g_steps: 10
        is_maml: 1
        kd_steps: 200
        warmup: 10
        lr_g: 0.002
        lr_z: 0.01
        oh: 0.5
        T: 10.0
        act: 0.0
        adv: 1.0
        bn: 5.0
        reset_l0: 1
        reset_bn: 0
        bn_mmt: 0.9
        syn_round: 5
        tau: 1
        nz: 100
        img_size: 28
        classes_per_task: 5

      # 服务器端测试数据集
      test_dataset:
        name: "MNIST"
        params:
          root: "./data"
          train: false
          download: true
        batch_size: 500

  aggregator:
    name: "fedavg"
    params: {}

model:
  name: "SimpleCNN"
  params:
    num_classes: 10

network:
  host: "127.0.0.1"
  port: 8765
