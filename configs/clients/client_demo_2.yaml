# MOE-FedCL 客户端配置示例
# client_demo_2.yaml

# ============================================
# 基本配置
# ============================================

# 通信模式: memory(单进程内存), process(多进程本地), network(分布式网络)
mode: process

client_id: "edge_node_2"

# ============================================
# 传输层配置 (Layer 5)
# ============================================
transport:
  # 通用传输配置
  timeout: 30.0              # 请求超时时间（秒）
  retry_attempts: 3          # 重试次数

  # 客户端HTTP服务器配置
  host: "127.0.0.1"          # 监听地址
  port: 8003                    # 监听端口（0=自动分配）
  websocket_port: 9501       # WebSocket端口（Network模式使用）

  # Network模式额外配置
  ssl_enabled: false         # 是否启用SSL/TLS
  connection_timeout: 30.0   # 连接超时时间


# ============================================
# 通信层配置 (Layer 4)
# ============================================
communication:
  # 心跳配置
  heartbeat_interval: 30.0   # 心跳间隔（秒）
  heartbeat_timeout: 90.0    # 心跳超时（秒）

  # 注册配置
  registration_timeout: 60.0 # 注册超时（秒）
  max_clients: 100           # 最大客户端数量（客户端一般不用）

  # RPC配置
  rpc_timeout: 120.0         # RPC调用超时（秒）


# ============================================
# Stub层配置（客户端专用）
# ============================================
stub:
  # 注册配置
  auto_register: true                # 启动时自动注册
  registration_retry_attempts: 3     # 注册重试次数
  registration_retry_delay: 5.0      # 注册重试间隔（秒）

  # 请求处理配置
  request_timeout: 120.0             # 请求超时（秒）
  max_concurrent_requests: 5         # 最大并发请求数


# ============================================
# 学习器配置（示例）
# ============================================
# 这部分配置会传递给 BaseLearner 实例
learner:
  # 数据配置
  data_path: "./data/client_data"    # 客户端数据路径
  batch_size: 32                     # 批次大小

  # 本地训练配置
  local_epochs: 5                    # 本地训练轮数
  learning_rate: 0.01                # 学习率
  optimizer: "sgd"                   # 优化器: sgd/adam

  # 模型配置
  model_name: "simple_cnn"           # 模型名称

  # 其他配置
  device: "cuda"                      # 设备: cpu/cuda
  random_seed: 42                    # 随机种子


# ============================================
# 示例使用场景
# ============================================

# Process模式（多进程本地测试）:
# - 客户端连接到本地服务端 127.0.0.1:8000
# - 客户端自动分配端口（port: 0）
# - 注册时将实际端口告知服务端

# Network模式（分布式部署）:
# - server_host: "192.168.1.100"  # 服务端实际IP
# - client_host: "192.168.1.101"  # 客户端实际IP
# - 需要确保网络互通

# Memory模式（单进程调试）:
# - mode: memory
# - 服务端和客户端在同一进程
# - 不需要网络配置

# ============================================
# 多客户端配置
# ============================================

# 方式1: 使用相同配置，自动生成不同client_id
# python run_client.py --config client_demo_1.yaml

# 方式2: 为每个客户端指定不同的client_id
# client_id: "client_1"
# client_id: "client_2"
# ...

# 方式3: 编程方式创建多个客户端
# for i in range(num_clients):
#     config = load_client_config("client_demo_1.yaml")
#     config.client_id = f"client_{i}"
#     client = FederationClient(config.to_dict(), client_id=config.client_id)
