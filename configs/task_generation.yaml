# configs/task_generation.yaml
# Task Generation Configuration for FedCL Framework
# 
# This configuration defines how learning tasks are generated for different
# continual learning scenarios in the federated learning environment.

# Basic task generation settings
task_generation:
  # Type of continual learning scenario
  # Options: "class_incremental", "domain_incremental", "task_incremental"
  type: "class_incremental"
  
  # Number of tasks to generate
  num_tasks: 10
  
  # Number of classes per task (for class incremental)
  classes_per_task: 10
  
  # Random seed for reproducible task generation
  random_seed: 42

  # Class Incremental Learning Configuration
  class_incremental:
    # Whether to shuffle the order of classes across tasks
    shuffle_classes: true
    
    # Random seed specifically for class shuffling
    random_seed: 42
    
    # Ensure balanced distribution of samples across classes
    balance_classes: true
    
    # Minimum samples per class per task
    min_samples_per_class: 50

  # Domain Incremental Learning Configuration
  domain_incremental:
    # List of domain names/datasets to use
    domains: 
      - "mnist"
      - "fashion_mnist" 
      - "cifar10"
      - "svhn"
    
    # Whether domains share the same label space
    shared_label_space: true
    
    # Domain adaptation settings
    domain_adaptation:
      enable: false
      method: "coral"  # coral, dann, mmd

  # Task Incremental Learning Configuration
  task_incremental:
    # Specific configurations for each task
    task_configs:
      - name: "classification_digits"
        description: "Classify digits 0-4"
        classes: [0, 1, 2, 3, 4]
        objective: "classification"
        batch_size: 64
        
      - name: "classification_letters"
        description: "Classify digits 5-9" 
        classes: [5, 6, 7, 8, 9]
        objective: "classification"
        batch_size: 64
        
      - name: "regression_task"
        description: "Regression on continuous values"
        classes: []  # All classes for regression
        objective: "regression"
        batch_size: 32
    
    # Whether to allow overlapping classes between tasks
    allow_class_overlap: false

  # Replay Buffer Configuration
  replay:
    # Enable replay buffer mechanism
    enable: true
    
    # Buffer size per class
    buffer_size_per_class: 50
    
    # Total buffer size limit (optional, overrides per_class if set)
    total_buffer_size: null
    
    # Sample selection strategy for replay buffer
    # Options: "random", "herding", "gradient_based", "uncertainty_based"
    selection_strategy: "random"
    
    # Replay buffer update strategy
    # Options: "replace", "merge", "prioritized"
    update_strategy: "replace"
    
    # Advanced replay settings
    advanced:
      # Use exemplar-based rehearsal
      exemplar_rehearsal: false
      
      # Distillation weight for replay
      distillation_weight: 0.5
      
      # Temperature for knowledge distillation
      distillation_temperature: 3.0

  # Task Validation Settings
  validation:
    # Minimum samples per task
    min_samples_per_task: 100
    
    # Maximum class imbalance ratio (max_class_count / min_class_count)
    max_imbalance_ratio: 10.0
    
    # Validate task sequence consistency
    validate_consistency: true
    
    # Check for memory constraints
    memory_check: true
    max_memory_per_task_mb: 1000

  # Visualization Settings
  visualization:
    # Enable automatic visualization generation
    enable: true
    
    # Output directory for visualizations
    output_dir: "./visualizations/tasks"
    
    # Generate class distribution plots
    class_distribution: true
    
    # Generate sample count plots
    sample_distribution: true
    
    # Generate memory usage plots
    memory_usage: true
    
    # Save format for plots
    format: "png"  # png, pdf, svg
    
    # DPI for saved plots
    dpi: 300

# Data Loading Configuration
data_loading:
  # Batch size for training
  batch_size: 32
  
  # Number of worker processes for data loading
  num_workers: 4
  
  # Whether to shuffle training data
  shuffle: true
  
  # Whether to drop the last incomplete batch
  drop_last: false
  
  # Pin memory for faster GPU transfer
  pin_memory: true

# Additional Task Generation Features
features:
  # Generate task metadata
  metadata_generation:
    enable: true
    include_statistics: true
    include_class_info: true
    include_sample_info: true
  
  # Task difficulty progression
  difficulty_progression:
    enable: false
    strategy: "linear"  # linear, exponential, custom
    start_difficulty: 0.1
    end_difficulty: 1.0
  
  # Cross-task correlation analysis
  correlation_analysis:
    enable: false
    methods: ["class_overlap", "feature_similarity", "sample_distance"]
  
  # Task sequence optimization
  sequence_optimization:
    enable: false
    objective: "minimize_catastrophic_forgetting"
    algorithm: "genetic"  # genetic, simulated_annealing, greedy

# Logging and Monitoring
logging:
  # Log level for task generation
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  
  # Log task generation statistics
  log_statistics: true
  
  # Save task generation logs
  save_logs: true
  log_file: "./logs/task_generation.log"

# Performance Optimization
performance:
  # Use multiprocessing for task generation
  multiprocessing: false
  max_workers: 4
  
  # Cache generated tasks
  cache_tasks: true
  cache_directory: "./cache/tasks"
  
  # Use memory mapping for large datasets
  memory_mapping: false
  
  # Lazy loading of task data
  lazy_loading: true
