# configs/hook_execution.yaml
# 钩子执行配置示例

hook_execution:
  # 错误处理策略
  # - continue: 继续执行剩余钩子
  # - stop: 停止整个执行流程
  # - skip_phase: 跳过当前阶段的剩余钩子
  error_policy: "continue"
  
  # 超时设置（秒）
  timeout: 30.0
  
  # 并行执行配置
  parallel_execution: false
  max_workers: 4  # 并行执行时的最大工作线程数
  
  # 日志配置
  logging:
    enable: true
    log_level: "INFO"  # DEBUG, INFO, WARNING, ERROR
    log_performance: true  # 是否记录性能信息
    log_hook_details: false  # 是否记录钩子详细信息
    
  # 监控配置
  monitoring:
    track_execution_time: true  # 跟踪执行时间
    max_execution_time: 10.0  # 最大执行时间警告阈值（秒）
    alert_on_slow_hooks: true  # 对慢钩子发出警告
    
    # 性能统计
    collect_stats: true
    stats_retention_count: 1000  # 保留的执行历史记录数量
    
  # 钩子阶段特定配置
  phase_configs:
    before_experiment:
      parallel_execution: false  # 实验前钩子必须串行执行
      timeout: 60.0  # 更长的超时时间
      
    after_experiment:
      parallel_execution: false  # 实验后钩子必须串行执行
      timeout: 120.0  # 清理工作可能需要更多时间
      
    before_task:
      parallel_execution: true  # 任务前钩子可以并行执行
      timeout: 30.0
      
    after_task:
      parallel_execution: true  # 任务后钩子可以并行执行
      timeout: 45.0  # 保存和评估可能需要更多时间
      
    before_batch:
      parallel_execution: false  # 批次钩子通常需要串行执行
      timeout: 5.0  # 批次钩子应该快速执行
      
    after_batch:
      parallel_execution: false
      timeout: 5.0
      
    on_error:
      parallel_execution: false  # 错误处理必须串行执行
      timeout: 15.0
      
    on_checkpoint:
      parallel_execution: true  # 检查点钩子可以并行执行
      timeout: 60.0  # 保存检查点可能需要较长时间
      
    on_evaluation:
      parallel_execution: true  # 评估钩子可以并行执行
      timeout: 30.0

# 钩子优先级配置指导
hook_priorities:
  # 系统级钩子（最高优先级）
  system_hooks:
    priority_range: [0, 10]
    examples:
      - logging_setup: 0
      - security_check: 1
      - resource_allocation: 2
      
  # 核心功能钩子
  core_hooks:
    priority_range: [10, 30]
    examples:
      - metrics_collection: 10
      - checkpoint_creation: 15
      - model_validation: 20
      
  # 业务逻辑钩子
  business_hooks:
    priority_range: [30, 70]
    examples:
      - data_augmentation: 30
      - custom_preprocessing: 40
      - feature_extraction: 50
      - regularization: 60
      
  # 用户自定义钩子
  user_hooks:
    priority_range: [70, 100]
    examples:
      - custom_metrics: 70
      - notification: 80
      - debugging: 90
      
  # 清理钩子（最低优先级）
  cleanup_hooks:
    priority_range: [100, 1000]
    examples:
      - temporary_file_cleanup: 100
      - memory_cleanup: 200
      - connection_cleanup: 500

# 钩子注册配置
hook_registration:
  # 是否允许重复注册同名钩子
  allow_duplicate_names: true
  
  # 是否验证钩子接口
  validate_interface: true
  
  # 钩子自动发现
  auto_discovery:
    enable: false
    search_paths: []
    
  # 钩子元数据要求
  metadata_requirements:
    name: true
    phase: true
    priority: false
    description: false
    author: false

# 高级配置
advanced:
  # 钩子间通信
  inter_hook_communication:
    enable: true
    message_timeout: 5.0
    
  # 条件执行
  conditional_execution:
    enable: true
    context_validation: true
    
  # 性能优化
  performance_optimization:
    hook_caching: false  # 是否缓存钩子实例
    lazy_loading: false  # 是否延迟加载钩子
    
  # 调试支持
  debugging:
    enable_tracing: false  # 启用钩子执行跟踪
    trace_level: "INFO"  # 跟踪级别
    save_execution_trace: false  # 保存执行跟踪到文件
