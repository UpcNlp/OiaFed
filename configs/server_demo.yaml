# MOE-FedCL 服务端配置示例
# server_demo.yaml

# ============================================
# 基本配置
# ============================================

# 通信模式: memory(单进程内存), process(多进程本地), network(分布式网络)
mode: process

server_id: "central_node"

# ============================================
# 传输层配置 (Layer 5)
# ============================================
transport:
  # 通用传输配置
  timeout: 30.0              # 请求超时时间（秒）
  retry_attempts: 3          # 重试次数

  # HTTP服务器配置
  host: "127.0.0.1"          # 监听地址（Process模式固定为127.0.0.1）
  port: 8000                 # HTTP服务端口
  websocket_port: 9501       # WebSocket端口（Network模式使用）

  # Network模式额外配置
  ssl_enabled: false         # 是否启用SSL/TLS
  connection_timeout: 30.0   # 连接超时时间


# ============================================
# 通信层配置 (Layer 4)
# ============================================
communication:
  # 心跳配置
  heartbeat_interval: 30.0   # 心跳间隔（秒）
  heartbeat_timeout: 90.0    # 心跳超时（秒）

  # 注册配置
  registration_timeout: 60.0 # 注册超时（秒）
  max_clients: 100           # 最大客户端数量

  # RPC配置
  rpc_timeout: 120.0         # RPC调用超时（秒）


# ============================================
# 联邦学习层配置
# ============================================
federation:
  coordinator_id: "fed_coordinator"  # 协调器ID
  max_rounds: 100                     # 最大训练轮数
  min_clients: 2                      # 最小客户端数量
  client_selection: "all"             # 客户端选择策略: all/random/custom

  # 训练配置
  training_config:
    # 聚合策略
    aggregation_method: "fedavg"      # 聚合方法: fedavg/fedprox/scaffold

    # 客户端选择
    clients_per_round: null           # 每轮选择的客户端数（null表示全部）

    # 早停配置
    early_stopping:
      enabled: true
      patience: 10                    # 容忍轮数
      min_delta: 0.001                # 最小改进值

    # 模型保存
    save_model:
      enabled: true
      save_interval: 10               # 每N轮保存一次
      save_path: "./checkpoints"      # 保存路径


# ============================================
# 示例使用场景
# ============================================

# Process模式（多进程本地测试）:
# - 适用于本地多进程联邦学习测试
# - 服务端和客户端都在同一台机器上
# - 使用HTTP通信，端口为127.0.0.1:8000

# Network模式（分布式部署）:
# - server_host: "0.0.0.0"  # 监听所有网络接口
# - 客户端可以从其他机器连接

# Memory模式（单进程调试）:
# - mode: memory
# - 所有组件在同一进程内
# - 适用于快速开发和调试
